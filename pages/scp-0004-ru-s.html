<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html">
  <meta name="description" content="Compilation of extracted CSS styles on the SCP Wiki">
  <meta name="keywords" content="scp,wiki,styles,wikidot">
  <meta name="author" content="SCP Wiki">
  <meta name="generator" content="wikidot-css-extractor">

  <script src="https://tristen.ca/tablesort/dist/tablesort.min.js"></script>
<script src="https://tristen.ca/tablesort/dist/sorts/tablesort.number.min.js"></script>
<script src="https://emmiegit.github.io/wikidot-css-extractor/static/script.js" async></script>
  <link rel="stylesheet" href="https://tristen.ca/tablesort/tablesort.css">
<link rel="stylesheet" href="https://emmiegit.github.io/wikidot-css-extractor/static/style.css">

  <title>SCP-0004-RU-S - Перекрёстные опыты с торговым автоматом</title>
</head>
<body>
<div id="container">
  
  <div class="page">
    <h1 class="title">SCP-0004-RU-S - Перекрёстные опыты с торговым автоматом</h1>
    <p>
      Link to article: <a href="https://scp-wiki.wikidot.com/scp-0004-ru-s" target="_blank">SCP-0004-RU-S - Перекрёстные опыты с торговым автоматом</a>.
    </p>

    <h2 class="header">Module Styles</h2>
    <ul class="module-styles">
      
        <li>
          (none)
        </li>
      
    </ul>

    <h2 class="header">Inline Styles</h2>
    <ul class="inline-styles">
      
        <li>
          <pre><code>width: 100%;</code></pre>
        </li>
      
        <li>
          <pre><code>padding: 5px; background-color: #FFFFF7; border: 1px solid silver; width: 95%;</code></pre>
        </li>
      
    </ul>

    <h2 class="header">Includes</h2>
    <ul class="includes">
      
        <li>(none)</li>
      
    </ul>

    <h2 class="header">CSS Classes</h2>
    <ul class="css-classes">
      
        <li>
          <pre><code>rimg</code></pre>
        </li>
      
        <li>
          <pre><code>wiki-content-table</code></pre>
        </li>
      
        <li>
          <pre><code>wiki-content-table</code></pre>
        </li>
      
        <li>
          <pre><code>image</code></pre>
        </li>
      
        <li>
          <pre><code>wiki-content-table</code></pre>
        </li>
      
    </ul>

    <h2 class="header">Page Source</h2>
    <pre><textarea class="page-source" readonly>[[&gt;]]
[[module Rate]]
[[/&gt;]]

[[div class=&#34;rimg&#34;]]
[[image http://sandbox.scpfoundation.ru/local--files/draft:wiiskey/RU-PDA.jpg width=&#34;300&#34;]] 
[[span]]SCP-261 установлен
 в испытательной лаборатории Зоны 7[[/span]] 
[[/div]]
 
Добрый день, Коллеги.
Данным письмом информирую Вас о том, что в рамках ежегодной программы культурного и информационного обмена между головным отделением Фонда и его Филиалами, в Зону 7 для проведения серии экспериментов был доставлен [[[SCP-261]]] «Межпространственный торговый автомат». Желающих принять участие в исследовании объекта просим проследовать на испытательный полигон Зоны 7 и записаться в очередь на тестирование. 

Напоминаю, что, согласно трудовому договору, ваши ошибки и низкие итоговые баллы, полученные по результатам оценок профессиональной деятельности, в зависимости от серьёзности совершённых проступков, могут вылиться в дисциплинарные взыскания вплоть до временного понижения в сотрудники класса D. Пожалуйста, воздержитесь от нарушения предписанных процедур, если не хотите чтобы ваши напарники и подчинённые ставили опыты уже на вас.

[[&gt;]]
С ув., м.н.с. отдела по исследованию интерактивных объектов
Д-р. Wiiskey
[[/&gt;]]

[[table style=&#34;width: 100%;&#34;]]
[[row]]
[[cell style=&#34;padding: 5px; background-color: #FFFFF7; border: 1px solid silver; width: 95%;&#34;]]
[[collapsible show=&#34;✉ &gt;&gt;Отправить заявку на участие&lt;&lt; ✉&#34; hide=&#34; &#34; folded=&#34;yes&#34; ]]

[[module ListUsers users=&#34;.&#34;]]
Добрый день, доктор **%%title%%**.
[[/module]]
Текущая заявка на проведение эксперимента была получена и одобрена. Ваше рабочее место подключено к приборам дистанционного наблюдения, чтобы обеспечить возможность удалённой работы.

Испытуемый сотрудник класса D уже получил соответствующие инструкции и ждёт ваших указаний у торгового автомата.
До начала опытов вы можете морально подготовить его к тому или иному роду деятельности, сделав упор на усилении или ослаблении каждой из его характеристик. Подробности о характеристиках находятся во всплывающей подсказке вашего терминала, доступной по наведению курсора мыши.

Помните, что отклонение любой из характеристик от среднестатистического значения наделяет подопытного способностью производить с её помощью особые события.

Целью данной работы является изучение долгосрочного воздействия пищи, полученной из торгового автомата, на человеческий организм.

Учтите, что по результатам вашей деятельности специальная комиссия даст итоговою оценку серии проведённых экспериментов, влияющую на размер ежемесячной премии.

На оценку оказывают влияние всевозможные редкие и не очень особенности, приобретённые подопытным, полученные им особые достижения, его общее состояние на момент окончания тестирования, и количество освоенных за время экспериментов денежных средств.

Перед началом тестирования рекомендуется ознакомиться с памяткой ответственного сотрудника.

Удачного дня.

----

[[html]]
&lt;style&gt;
@import url(http://scpfoundation.ru/local--files/scp-0001-ru-s/style.css);
@import url(http://scpfoundation.ru/local--files/scp-0001-ru-s/style2.css);
&lt;/style&gt;

&lt;div style =&#39;text-align:right;&#39;&gt;
&lt;a id = &#34;chanL&#34; href=&#34;#&#34; onclick=&#34;changeLan();&#34;&gt;Eng&lt;/a&gt;
&lt;/div&gt;

&lt;p id=&#34;introTxt&#34;&gt;SOMETEXT3&lt;/p&gt; &lt;br&gt;

&lt;table style=&#39;width:100%; &#39;&gt;&lt;tr&gt;&lt;td style =&#39;width:25%&#39;&gt;


&lt;table  class=&#34;wiki-content-table&#34;&gt;
&lt;tr &gt;
 &lt;td id = &#34;CCd0&#34;&gt;
   &lt;div align=&#34;center&#34;;  style=&#34;font-weight :bold; font-size: 12px; color: #000;&#34;&gt;
    &lt;p id=&#34;cap1&#34;&gt;CAPTION1&lt;/p&gt;
   &lt;/div&gt;
 &lt;/td&gt;

 &lt;td &gt;
   &lt;div align=&#34;center&#34;;  style=&#34;font-weight :bold; font-size: 12px; color: #000;&#34;&gt;
    &lt;p id=&#34;cap2&#34;&gt;CAPTION2&lt;/p&gt;
   &lt;/div&gt;
 &lt;/td&gt;

&lt;/tr&gt;
&lt;tr&gt;
    &lt;td&gt;

&lt;table class=&#34;wiki-content-table&#34; id=&#39;tbl1&#39;&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td colspan=&#34;2&#34; &gt;
&lt;div  align=&#34;center&#34; &gt;
&lt;img src=&#39;&#39; alt=&#39;&#39; id=&#34;pic1&#34;  style=&#34;max-height:300px;max-width:400px;width: expression(this.width &gt; 400 ? 400: true);&#34;  class=&#34;image&#34;&gt;&lt;/div&gt;&lt;/td&gt;


&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;

&lt;table class=&#34;wiki-content-table&#34;&gt;

&lt;tr&gt;
&lt;td&gt;&lt;p id=&#34;stat01&#34;&gt;STAT1&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p id=&#34;stat11&#34;&gt;100&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;p id=&#34;stat02&#34;&gt;STAT2&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p id=&#34;stat12&#34;&gt;0&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;p id=&#34;stat03&#34;&gt;STAT3&lt;/p&gt;&lt;/td&gt;
&lt;td&gt;&lt;p id=&#34;stat13&#34;&gt;0&lt;/p&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;/table&gt;

&lt;/th&gt;
&lt;/tr&gt;





&lt;/tbody&gt;&lt;/table&gt;   

 &lt;b&gt;&lt;span id=&#34;step01&#34;&gt;STEP&lt;/span&gt;&lt;/b&gt;&amp;nbsp
 &lt;span id=&#34;step11&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;br&gt;

 &lt;b&gt;&lt;span  id=&#34;score01&#34;&gt;SCORE&lt;/span &gt;&lt;/b&gt;&amp;nbsp
 &lt;i&gt;&lt;span id=&#34;score11&#34;&gt;0&lt;/span&gt;&lt;/i&gt;&amp;nbsp&lt;b&gt;&lt;span id=&#34;score21&#34;&gt;¥&lt;/span&gt;&lt;/b&gt;

&lt;/td&gt;

&lt;td&gt;

&lt;table&gt;
&lt;tr &gt;
&lt;td&gt;&lt;p id=&#34;spec01&#34; &gt;S1&lt;/p&gt;&lt;/td&gt;&lt;th&gt;&lt;p id=&#34;spec11&#34;&gt;5&lt;/p&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr &gt;
&lt;td&gt;&lt;p id=&#34;spec02&#34; &gt;S2&lt;/p&gt;&lt;/td&gt;&lt;th&gt;&lt;p id=&#34;spec12&#34;&gt;5&lt;/p&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr &gt;
&lt;td&gt;&lt;p id=&#34;spec03&#34; &gt;S3&lt;/p&gt;&lt;/td&gt;&lt;th&gt;&lt;p id=&#34;spec13&#34;&gt;5&lt;/p&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr &gt;
&lt;td&gt;&lt;p id=&#34;spec04&#34; &gt;S4&lt;/p&gt;&lt;/td&gt;&lt;th&gt;&lt;p id=&#34;spec14&#34;&gt;5&lt;/p&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr &gt;
&lt;td&gt;&lt;p id=&#34;spec05&#34; &gt;S5&lt;/p&gt;&lt;/td&gt;&lt;th&gt;&lt;p id=&#34;spec15&#34;&gt;5&lt;/p&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr &gt;
&lt;td&gt;&lt;p id=&#34;spec06&#34; &gt;S6&lt;/p&gt;&lt;/td&gt;&lt;th&gt;&lt;p id=&#34;spec16&#34;&gt;5&lt;/p&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;tr &gt;
&lt;td&gt;&lt;p id=&#34;spec07&#34; &gt;S7&lt;/p&gt;&lt;/td&gt;&lt;th&gt;&lt;p id=&#34;spec17&#34;&gt;5&lt;/p&gt;&lt;/th&gt;
&lt;/tr&gt;

&lt;/table&gt;

&lt;/td&gt;



&lt;/tr&gt;
&lt;/table&gt;

&lt;/td&gt;&lt;td id = &#34;CCd&#34; &gt;


&lt;div id=&#34;CCd2&#34;; style=&#39;overflow: hidden; width:100%; position: relative; &#39;&gt;
&lt;p id=&#34;Ofield&#34;  style=&#39;margin: 10px&#39; &gt;Loading...&lt;br&gt;Если вы видите этот текст вместо статьи, пожалуйста, смените браузер или попробуйте зайти на страницу с другого компьютера&lt;/p&gt;



&lt;div id=&#34;CCd3&#34;; style=&#39;float:bottom;  position: absolute; bottom:0; width:90%; margin: 10px;&#39; &gt;

&lt;p id=&#34;Tfield&#34;  style=&#39;margin: 10px&#39; &gt;Loading...&lt;/p&gt;

&lt;br&gt;

&lt;div id = &#34;trayBtn&#34; style=&#34; display:none;&#34;&gt;
&lt;button id = &#34;yesBtn&#34; type=&#34;button&#34; onclick=&#34;yesNo(1)&#34;  style=&#34;cursor:pointer; font-face: &#39;Comic Sans MS&#39;; font-weight :bold; font-size: 12px; color: #000; background-color: #00F100; border: 3pt ridge lightgrey; width: 60%; height:50px;&#34; &gt;
  VAR1
&lt;/button&gt;

&lt;button id = &#34;noBtn&#34; type=&#34;button&#34; onclick=&#34;yesNo(0)&#34;  style=&#34;cursor:pointer; font-face: &#39;Comic Sans MS&#39;; font-weight :bold; font-size: 12px; color: #000; background-color: #F10000; border: 3pt ridge lightgrey; width: 30%; height:50px;&#34; &gt;
  VAR2
&lt;/button&gt;
&lt;/div&gt;

&lt;/div&gt;

&lt;/div   &gt;

&lt;/td&gt;
&lt;/tr&gt;&lt;/table&gt;



&lt;div id = &#34;coinBtn&#34; style = &#34;border: 1pt ridge black; text-align:center;&#34;&gt; 
&lt;p id = &#39;butTxt&#39;&gt;TEXT1&lt;/p&gt; &lt;/b&gt; &lt;br&gt; 

&lt;button id = &#34;aBtn1&#34; type=&#34;button&#34; onclick=&#34;showBtn(0)&#34;  style=&#34;cursor:pointer; font-face: &#39;Comic Sans MS&#39;; font-weight :bold; font-size: 12px; color: #A30000; background-color: #FFFFC0; border: 3pt ridge lightgrey; width: 19%; height:40px;&#34; &gt;
  A
&lt;/button&gt;

&lt;button id = &#34;aBtn2&#34; type=&#34;button&#34; onclick=&#34;showBtn(1)&#34;  style=&#34;cursor:pointer; font-face: &#39;Comic Sans MS&#39;; font-weight :bold; font-size: 12px; color: #A30000; background-color: #FFFFC0; border: 3pt ridge lightgrey; width: 19%;height:40px;&#34; &gt;
  B
&lt;/button&gt;

&lt;button id = &#34;aBtn3&#34; type=&#34;button&#34; onclick=&#34;showBtn(2)&#34;  style=&#34;cursor:pointer; font-face: &#39;Comic Sans MS&#39;; font-weight :bold; font-size: 12px; color: #A30000; background-color: #FFFFC0; border: 3pt ridge lightgrey; width: 19%;height:40px;&#34; &gt;
  C
&lt;/button&gt;

&lt;button id = &#34;aBtn4&#34; type=&#34;button&#34; onclick=&#34;showBtn(3)&#34;  style=&#34;cursor:pointer; font-face: &#39;Comic Sans MS&#39;; font-weight :bold; font-size: 12px; color: #A30000; background-color: #FFFFC0; border: 3pt ridge lightgrey; width: 19%;height:40px;&#34; &gt;
  D
&lt;/button&gt;

&lt;button id = &#34;aBtn5&#34; type=&#34;button&#34; onclick=&#34;showBtn(4)&#34;  style=&#34;cursor:pointer; font-face: &#39;Comic Sans MS&#39;; font-weight :bold; font-size: 12px; color: #A30000; background-color: #FFFFC0; border: 3pt ridge lightgrey; width: 19%;height:40px;&#34; &gt;
  E
&lt;/button&gt;

&lt;br&gt;&lt;br&gt;
&lt;/div&gt;


&lt;div id = &#34;endBtn&#34; style=&#34; display:none;&#34;&gt;

&lt;button id = &#34;theEndBtn&#34; type=&#34;button&#34; onclick=&#34;redir_pg()&#34; style=&#34;cursor:pointer; font-face: &#39;Comic Sans MS&#39;; font-weight :bold; font-size: 12px; color: #000; background-color: #ffffff; border: 1pt ridge lightgrey; width: 100%; height:50px;&#34; &gt;
  VAR1
&lt;/button&gt;

&lt;/div&gt;


&lt;script type=&#34;text/javascript&#34; src=&#34;http://scpfoundation.ru/local--files/scp-0004-ru-s/cry01.js&#34;&gt;&lt;/script&gt; 


&lt;script type=&#34;text/javascript&#34;&gt;

dName = &#34;D-&#34; + Math.floor((Math.random() * 10) + 0).toString()+ Math.floor((Math.random() * 10) + 0).toString()+ Math.floor((Math.random() * 10) + 0).toString()+ Math.floor((Math.random() * 10) + 0).toString();



//Arrays section
mB = eval(unescape(a));

var interface_ru = mB[0];
var eventTexts_ru = mB[1];
var condTxt_ru = mB[2];
var randomChecks_ru =  mB[3];
var descrTxt_ru = mB[4];
var texts_ru =mB[5];
var greatAchievements_ru =mB[6];



var texts_en = [];
var randomChecks_en = [];
var condTxt_en = [ ];
var interface_en = [];
var descrTxt_en = [];
var greatAchievements_en = [];
var eventTexts_en =[];


var interfaceText = interface_ru;
var eventTexts = eventTexts_ru;
var theTexts = texts_ru;
var condTxt = condTxt_ru;
var randomChecks = randomChecks_ru
var greatAchievements = greatAchievements_ru;
var descrTxt = descrTxt_ru;

var subjCon = [&#39;&#39;];
var curAch = [];

var critStatsCheck = [[0,10,0],[1,280,9],[2,280,14]];

var specs = [5,5,5,5,5,5,5,&#39;&#39;];
var stats = [100,0,0];
var noRefresh = 0;

var randLims = [[0,0],[0,2],[1,2],[1,3],[2,3]];
var min_randLims = [[0,0],[0,2],[1,2],[1,3],[2,3]];

var qualityChance = [30, 23, 13, 6.2, 1.8, 0.5]
var qualityChanceClr = [30, 23, 13, 6.2, 1.8, 0.5]
var max_qualityChance = [25, 30, 20, 11, 7, 2]

var usedAbilities = [];
var expAbilities = []

var itemSuffixes =[];
var itemPrefixes =[];
var originalDishes = [];
var pressedRecord = [0,0,0,0,0];


//Var section
var CCd0 = document.getElementById(&#34;CCd&#34;).offsetHeight;
var step = 0;
var deathEvaded = 0;
var money = 0;
var lastMoney = 0;
var resultTxt = &#34;&#34;;
var effectTxt = &#34;&#34;;
var pressedBtn = 0;
var itemQuality = 0;
var item = 0;
var itemAbility = 0;
var isDead = 0;
var isRunAway = 0;
var dishes = 0;
var specPoints = 3;
var noDisplay = 0;
var finalTxt =&#39;&#39;;
var totalScore = 0;
var denyOfEating = 0;
var oneKUsed = 0;
var giveRare = 0;
var aSceptic = 0;
var anOptimist = 0;
var deathProtected = 0;
var theBuff = 1;
var mortSpecial = &#39;&#39;;
var isMilitary = 0;
var showChars = 0;


var dPic = Math.floor((Math.random() * descrTxt[0].length) + 0);
var dropTxt = &#39;&#39;;


//start

 if( ( ( parseInt(dName.substr(2,1)) ==  parseInt(dName.substr(3,1)) + 1) &amp;&amp;
       ( parseInt(dName.substr(3,1)) ==  parseInt(dName.substr(4,1)) + 1) &amp;&amp; 
       ( parseInt(dName.substr(4,1)) ==  parseInt(dName.substr(5,1) + 1)) ) ||
     ( ( parseInt(dName.substr(2,1)) ==  parseInt(dName.substr(3,1)) - 1) &amp;&amp; 
       ( parseInt(dName.substr(3,1)) ==  parseInt(dName.substr(4,1)) - 1) &amp;&amp; 
       ( parseInt(dName.substr(4,1)) ==  parseInt(dName.substr(5,1) - 1)) ) ){
    addAchievement(34);
 }
 if(Math.floor((Math.random() * 1000001) + 0) &lt; 1 ){addAchievement(33);}
 setInterface(); 
 addCondition(condTxt[0][0]);  



                                                          //NEXT STEP
function nextStep(stp){
 
 var subjTxt = &#34;&#34;;
 var increaser = Math.floor(Math.random() * (randLims[pressedBtn][1] - randLims[pressedBtn][0] + 1) + randLims[pressedBtn][0]);
 var amount = 0;
 var foodStats = [0,0,0];
 var i = 0;
 
 step = step + stp;
 if (step == 1 ) {noRefresh = 1; setInterface();}


 setStats();

 document.getElementById(&#34;score11&#34;).innerHTML = money;

 if (deathEvaded&gt;=3){addAchievement(1);}
 if (deathEvaded&gt;=5){addAchievement(2);}
 if (step&gt;=50){addAchievement(36);}
 if (step&lt;=10 &amp;&amp; isRunAway &gt; 0){addAchievement(38);}

    //Resurrect
    if (isDead &gt; 0 &amp;&amp; deathProtected == 1){
       isDead = 0;
       deathProtected = 0;
        resultTxt = resultTxt + interfaceText[72];
    }


                                                                   //ITEMS ROUTINE
 if (stp ==1){

   if (money&gt;=9000 &amp;&amp; oneKUsed &lt;= 1){addAchievement(37);}

   dishes = dishes + 1;   

   itemQuality = 0;
   itemPrefixes = [];
   itemSuffixes = [];
   itemAbility = 0;
   addIndex = 0; 

   //set quality chances

     qualityChance[0] = qualityChance[0] - 1; 
     if (qualityChance[0]&lt;max_qualityChance[0]){qualityChance[0] = max_qualityChance[0]}
     if (qualityChance[1]&lt;max_qualityChance[1]){qualityChance[1] = max_qualityChance[1]}
   for (i=1; i&lt;6; i++){
     qualityChance[i] = qualityChanceClr[i] + (max_qualityChance[i] - qualityChanceClr[i]) * (dishes / 10);
     if (qualityChance[i]&gt;max_qualityChance[i]){qualityChance[i] = max_qualityChance[i]}
   }

   btnMod = 0;
   //button modifier
   switch (pressedBtn) {
    case 0: btnMod = qualityChance[0] * 0; break;
    case 1: btnMod = qualityChance[0] * 0.1; break;
    case 2: btnMod = qualityChance[0] * 0.2; break;
    case 3: btnMod = qualityChance[0] * 0.3; break;
    case 4: btnMod = qualityChance[0] * 0.4; break;
   }

     qualityChance[0] = qualityChance[0] -  btnMod; 
     qualityChance[1] = qualityChance[1] -  btnMod * 0.8; 
  
     qualityChance[2] = qualityChance[2] +  btnMod*0.3; 
     qualityChance[3] = qualityChance[3] +  btnMod*0.4;
     qualityChance[4] = qualityChance[4] +  btnMod*0.5; 
     qualityChance[5] = qualityChance[5] +  btnMod*0.6;


   dropTxt =  descrTxt[1][Math.floor((Math.random() * descrTxt[1].length) + 0)];
   if (isMilitary == 1) {   dropTxt = interfaceText[73] + dropTxt }
  
   resultTxt = resultTxt + dropTxt + &#39;&lt;br&gt;&lt;br&gt;«&lt;font size = &#34;4&#34;&gt;&#39;;

   document.getElementById(&#34;step11&#34;).innerHTML = step;

   //Choose quality
   itemQuality = 0;
   qualThresh = Math.random() * 100
   for (i=5; i&gt;=0; i--){
    if(qualThresh &gt; 0){
     qualThresh = qualThresh - qualityChance[i]
     if (qualThresh &lt;= 0) {  itemQuality = i + 1; }
    }
   }
  
   if  (giveRare == 1) {  giveRare = 0; itemQuality = 6; }

 // itemQuality = 6;  //Cheat

           
   if (specs[6] &lt;5)	{
     lucMod = (10-specs[6]*2)/100;

     //downgrade
     if (Math.random() &lt; lucMod &amp;&amp; itemQuality &gt; 0){
     
        itemQuality = itemQuality - 1;
     }
   }
   
   
   if (specs[6] &gt;5)	{
     lucMod = (specs[6]*2)/100;

     //upgrade
     if (Math.random() &lt; lucMod &amp;&amp; itemQuality &lt; 6){
        itemQuality = itemQuality + 1;
     }
   }
   
    //choose prefixes
    cnt = 0;
    amount = Math.floor((Math.random() * (itemQuality+1)) + 0);
      switch (itemQuality){
         case 2: if (amount&gt;1){amount = 1}break;
         case 3: if (amount&gt;1){amount = 1}break;
         case 4: if (amount&lt;1){amount = 1}  if (amount&gt;2){amount = 2}break;
         case 5: if (amount&lt;1){amount = 1}  if (amount&gt;2){amount = 2}break;
         case 6: if (amount&lt;2){amount = 2}  if (amount&gt;3){amount = 3}break;
      }
    while (itemPrefixes.length &lt; amount){
         isUsed = 1;         
             while (isUsed &amp;&amp; cnt &lt; 100) {
                isUsed = 0;   
                addIndex = Math.floor((Math.random() * theTexts[2].length) + 0);
                for (i=0; i&lt;itemPrefixes.length; i++){
                    if (itemPrefixes[i] == addIndex){isUsed = 1;}
                 }
                 cnt++;
              }
         itemPrefixes.push(addIndex); 
    	 foodStats[0] = foodStats[0] + theTexts[2][addIndex][1][4];
    	 foodStats[1] = foodStats[1] + theTexts[2][addIndex][1][5];
    	 foodStats[2] = foodStats[2] + theTexts[2][addIndex][1][6];
     }
     //choose suffixes
     cnt = 0;
    amount2 = Math.floor((Math.random() * (itemQuality+1)) + 0);
      switch (itemQuality){
         case 1: if (amount&gt;0){amount2 = 0} break;
         case 2: if (amount&gt;0){amount2 = 0}break;
         case 3: if (amount + amount2&gt;2){amount2 = 1}break;
         case 4: if (amount + amount2&gt;2){amount2 = 1} if (amount2&lt;1){amount2 = 1} break;
         case 5: if (amount2&lt;1){amount2 = 1} if (amount2&gt;2){amount2 = 2}break;
         case 6: if (amount2&lt;2){amount2 = 2} if (amount2&gt;3){amount2 = 3}break;
      } 
    while (itemSuffixes.length &lt; amount2){
         isUsed = 1;         
             while (isUsed &amp;&amp; cnt &lt; 100) {
                isUsed = 0;   
                addIndex = Math.floor((Math.random() * theTexts[3].length) + 0);
                for (i=0; i&lt;itemSuffixes.length; i++){
                    if (itemSuffixes[i] == addIndex){isUsed = 1;}
                 }
                cnt++;
              }
         itemSuffixes.push(addIndex);
    	 foodStats[0] = foodStats[0] + theTexts[3][addIndex][1][4];
    	 foodStats[1] = foodStats[1] + theTexts[3][addIndex][1][5];
    	 foodStats[2] = foodStats[2] + theTexts[3][addIndex][1][6];
     }
   
   //choose ability
   abThresh = Math.random(); 
   if ( (itemQuality == 3 &amp;&amp;  abThresh &lt; 0.01) || (itemQuality == 4 &amp;&amp;  abThresh &lt; 0.1) || (itemQuality == 5 &amp;&amp;  abThresh &lt; 0.25) || (itemQuality == 6 &amp;&amp;  abThresh &lt; 0.75) ) {


             //use only new abilities
             cnt = 0;
             isUsed = 1;   
             while (isUsed == 1 &amp;&amp; cnt &lt; 100) {

                isUsed = 0;   
                itemAbility = Math.floor((Math.random() * (theTexts[4].length - 2)) + 1);
                for (i=0; i&lt;usedAbilities.length; i++){
                    if (usedAbilities[i] == itemAbility){isUsed = 1;}
                 }
                cnt++;
              }

   }    

  //itemAbility = 6; //2Test

   //choose item
   item = Math.floor((Math.random() * (theTexts[1].length - 1)) + 0);

   foodStats[0] = foodStats[0] + theTexts[1][item][1][4];
   foodStats[1] = foodStats[1] + theTexts[1][item][1][5];
   foodStats[2] = foodStats[2] + theTexts[1][item][1][6];
   


 
   resultTxt = resultTxt + theTexts[0][itemQuality] + &#39; &#39;;
   
   for (i=0;i&lt;itemPrefixes.length;i++){
       resultTxt = resultTxt + theTexts[2][itemPrefixes[i]][0] + &#39; &#39;;
   }
 
   resultTxt = resultTxt + theTexts[1][item][0][0]+ &#39; &#39;;

   for (i=0;i&lt;itemSuffixes.length;i++){

   
       suffCorrName = theTexts[3][itemSuffixes[i]][0];
       
       if (theTexts[3][itemSuffixes[i]][0].substr(0,1) == &#39;,&#39; ){
          if ( i == 0) {
            resultTxt = resultTxt.substr(0,resultTxt.length - 1) + &#39;, &#39;; 
    	  } 
    	 //del comar
    	 suffCorrName = theTexts[3][itemSuffixes[i]][0].substr(1,theTexts[3][itemSuffixes[i]][0].length);
       }
       
       
       separSign = &#39;&#39;;
       if (i &lt; itemSuffixes.length -2) { separSign = &#39;, &#39;}
       if (i == itemSuffixes.length -2) { separSign = interfaceText[82]}

       resultTxt = resultTxt + suffCorrName + separSign;
   }
   
   //resultTxt = resultTxt.substr(1, resultTxt.length - 3);

   resultTxt = (resultTxt + &#39; &#39; + theTexts[4][itemAbility][0]).trim() + &#39;&lt;/font&gt;»&#39;;



   //update limits

   randLims[pressedBtn][1] = randLims[pressedBtn][1] + 2;

   for (i=1; i&lt;5; i++){
      if (i != pressedBtn){
         randLims[i][1] = randLims[i][1] - 1;
         if(randLims[i][1] &lt; min_randLims[i][1]){ randLims[i][1] = randLims[i][1] + 1 };
      }
   }



   if (noDisplay == 1) {

           resultTxt = interfaceText[51];
           noDisplay = 0;
   }
   
   if (showChars &gt; 0){
     
        if (foodStats[0] &lt; 0) {foodStats[0] = &#39;&lt;font color = &#34;#ff0000&#34;&gt;&#39; + foodStats[0] + &#39;&lt;/font&gt;&#39;} else { foodStats[0] = &#39;&lt;font color = &#34;#006600&#34;&gt;+&#39; + foodStats[0] + &#39;&lt;/font&gt;&#39;}
    	if (foodStats[1] &lt; 0) {foodStats[1] = &#39;&lt;font color = &#34;#006600&#34;&gt;&#39; + foodStats[1] + &#39;&lt;/font&gt;&#39;} else { foodStats[1] = &#39;&lt;font color = &#34;#ff0000&#34;&gt;+&#39; + foodStats[1] + &#39;&lt;/font&gt;&#39;}
    	if (foodStats[2] &lt; 0) {foodStats[2] = &#39;&lt;font color = &#34;#006600&#34;&gt;&#39; + foodStats[2] + &#39;&lt;/font&gt;&#39;} else { foodStats[2] = &#39;&lt;font color = &#34;#ff0000&#34;&gt;+&#39; + foodStats[2] + &#39;&lt;/font&gt;&#39;}
    	
        resultTxt = resultTxt + &#39;&lt;br&gt;[&#39; + interfaceText[83].replace(&#39;:hp:&#39;,foodStats[0]).replace(&#39;:hg:&#39;,foodStats[1]).replace(&#39;:th:&#39;,foodStats[2]) + &#39;]&#39;;
        showChars = showChars - 1;
   }

 } else {

 
    resultTxt = resultTxt + interfaceText[24];
 
 }





//if (step==5) { isDead = 1};



   //Subject is dead or Run away
  if (isDead &gt; 0 || isRunAway &gt; 0) {
    switch (isDead){
      case 1: finalTxt = &#39;&lt;font color=#ff0000&gt;&#39; + descrTxt[2][Math.floor((Math.random() *  descrTxt[2].length) + 0)] + &#39;&lt;/font&gt;&#39;; break;
      case 2: finalTxt = &#39;&lt;font color=#ff0000&gt;&#39; + descrTxt[3][Math.floor((Math.random() *  descrTxt[3].length) + 0)] + &#39;&lt;/font&gt;&#39;; break;
      case 3: finalTxt = &#39;&lt;font color=#ff0000&gt;&#39; + descrTxt[4][Math.floor((Math.random() *  descrTxt[4].length) + 0)] + &#39;&lt;/font&gt;&#39;; break;
      case 5: finalTxt = &#39;&lt;font color=#ff0000&gt;&#39; + interfaceText[60] + &#39;&lt;/font&gt;&#39;; break;
    }

     usedBtns = 0;
     for (i=0; i&lt;5; i++) {
       if (pressedRecord[i] &gt; 0) {usedBtns = usedBtns + 1}
     }
     if (usedBtns == 1) {addAchievement(39); }





     resultTxt =  resultTxt.replace(interfaceText[24],&#39;&#39;)

        mortTxt = &#39;&lt;br&gt;&lt;br&gt;&#39;;  
        for (i=0; i&lt; originalDishes.length; i++){
           mortTxt = mortTxt + theTexts[1][originalDishes[i]][2];

           if (theTexts[1][originalDishes[i]][2].indexOf(interfaceText[84]) == -1) {
              mortTxt = mortTxt + &#39; &#39; + interfaceText[85].replace(&#39;:fd:&#39;,theTexts[1][originalDishes[i]][0][1]) + &#39;.&lt;br&gt;&lt;br&gt;&#39;;		   
              totalScore = totalScore + 2;		   
    	   } else {
    	      mortTxt = mortTxt + &#39;.&lt;br&gt;&lt;br&gt;&#39;;		   
              totalScore = totalScore + 1;
           }
    	 }

     if (isRunAway &gt; 0) {
        resultTxt =  resultTxt +  interfaceText[52];
        totalScore =  totalScore + 15;
     } else {

        if (dPic == 6){addAchievement(40);}

        resultTxt =  resultTxt + &#39;&lt;br&gt;&lt;br&gt;&lt;b&gt;&#39; + finalTxt + &#39;&lt;/b&gt;&lt;br&gt;&lt;br&gt;&#39; + interfaceText[36] + dishes  + interfaceText[37] + mortTxt + &#39;&lt;br&gt;&#39; + mortSpecial + &#39;&lt;br&gt;&lt;br&gt;&#39;  + interfaceText[53]; 
    	
    	if (isDead == 4) {resultTxt = resultTxt + interfaceText[86]}
     }

      document.getElementById(&#34;coinBtn&#34;).style.display = &#39;none&#39;;
      document.getElementById(&#34;trayBtn&#34;).style.display = &#39;none&#39;;
      document.getElementById(&#34;endBtn&#34;).style.display = &#39;block&#39;;


      //count scores
      for (i=0; i&lt;7; i++) { totalScore =  totalScore + specs[i]/2 }

      for (i=0; i&lt;subjCon.length; i++) { 
           if (subjCon[i].indexOf( interfaceText[64]) == -1 ) { 
              totalScore =  totalScore + 1 
           } else { 
              totalScore =  totalScore + 3
           } 
      }

      for (i=0; i&lt;curAch.length; i++) {  if (greatAchievements[curAch[i]].substr(10,11) == greatAchievements[2].substr(10,11) ) { totalScore =  totalScore + 3} else {totalScore =  totalScore + 5} }

      totalScore = Math.round(totalScore + stats[0]/10 + (300-stats[1])/300 + (300-stats[2])/300 + Math.abs(money)/5000 + step/5 +specPoints + dishes/5 );
     

      resultTxt =  resultTxt + &#39;&lt;br&gt;&lt;br&gt;&#39; +  interfaceText[58].replace(&#39;:sc:&#39;,totalScore);

  }




    //Check special abilities zzz
//itemAbility = 18;
    for (i=0; i&lt; usedAbilities.length; i++){
       if ( expAbilities[i] == 0) {
        switch (usedAbilities[i]){

              case 1:    
                         resultTxt = resultTxt.replace(new RegExp(interfaceText[22], &#39;gi&#39;) ,interfaceText[25]); 
                         break;
              case 2:    
                         mortSpecial = mortSpecial + descrTxt[8][8] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 3:    
                         mortSpecial = mortSpecial + descrTxt[8][9] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 4:    
                         mortSpecial = mortSpecial + descrTxt[8][10] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 5: 
                         for (k=0;k&lt;7;k++) { interfaceText[7+k] = interfaceText[7]; } noRefresh = 1; setInterface(); expAbilities[i] = 1;
                         break;
              case 6: 
                         for (k=0;k&lt;descrTxt[5][0].length;k++){
                            resultTxt = resultTxt.replace(interfaceText[65] + descrTxt[5][0][k], interfaceText[65] + descrTxt[5][0][k] + &#39;&lt;font color =&#34;#6b6b47&#34;&gt;&#39;+descrTxt[5][1][Math.floor((Math.random() * descrTxt[5][1].length) + 0)] + descrTxt[5][0][k] + &#39;&lt;/font&gt;&#39;); 
                         }
                         resultTxt = resultTxt.replace(interfaceText[66] ,interfaceText[67]); 
                         break;
              case 7: 
                         money = Math.round(parseInt(money) * 0.9);  document.getElementById(&#34;score11&#34;).innerHTML = money.toString(); expAbilities[i] = 1;
                         break;
              case 8: 
                         document.getElementById(&#34;cap1&#34;).innerHTML = document.getElementById(&#34;cap1&#34;).innerHTML.replace(dName,&#39;D-7777&#39;); 
                         for (k=0; k&lt;interfaceText.length; k++) { interfaceText[k] = interfaceText[k].replace(dName, &#39;D-7777&#39;); }
    					 for (k=0; k&lt;randomChecks.length; k++) { 
    					   for (l=3; l&lt;randomChecks[k].length; l++) { 
    					    randomChecks[k][l] = randomChecks[k][l].replace(dName, &#39;D-7777&#39;); 
    					   }
    					 }
                         dName = &#39;D-7777&#39;; expAbilities[i] = 1;
                         break;
              case 9: 
                         money = money + 3007; document.getElementById(&#34;score11&#34;).innerHTML = money; expAbilities[i] = 1;
                         break;
              case 10:    
                         mortSpecial = mortSpecial + descrTxt[8][11] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 11:    
                         mortSpecial = mortSpecial + descrTxt[8][12] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 12:    
                         mortSpecial = mortSpecial + descrTxt[8][13] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 13:
                         interfaceText[21] = &#39;&lt;b&gt;Poinstruować kurva &#39; + dName + &#39; obciążenia do urządzenia następujące kwoty na zakup&lt;/b&gt;&#39;; noRefresh = 1; setInterface();
                         expAbilities[i] = 1;
                         break;
             case 14:    
                         mortSpecial = mortSpecial + descrTxt[8][14] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 15: 
                         resultTxt = resultTxt.replace(new RegExp(interfaceText[68], &#39;g&#39;), interfaceText[69]); expAbilities[i] = 1;
                         for (k=0; k&lt;interfaceText.length; k++) { interfaceText[k] = interfaceText[k].replace(interfaceText[68], interfaceText[69]); }
                         for (k=0; k&lt;interfaceText.length; k++) { interfaceText[k] = interfaceText[k].replace(interfaceText[77], interfaceText[78]); }
                         break;
             case 16:    
                         mortSpecial = mortSpecial + descrTxt[8][15] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 17:
                         resultTxt = resultTxt.replace(new RegExp(interfaceText[24], &#39;g&#39;), interfaceText[70]); expAbilities[i] = 1;
                         interfaceText[24] = interfaceText[70]
                         break;
              case 18:
                         for (k=0; k&lt;interfaceText.length; k++) { interfaceText[k] = interfaceText[k].replace(&#39;¥&#39;,&#39;₽&#39;); }; 
                         document.getElementById(&#34;score21&#34;).innerHTML =&#39;₽&#39;; noRefresh = 1; setInterface(); expAbilities[i] = 1;
                         break;
             case 19:    
                         mortSpecial = mortSpecial + descrTxt[8][16] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 20:
                         giveRare = 1; expAbilities[i] = 1;
                         break;
              case 21:
                         aSceptic = 1; expAbilities[i] = 1;
                         break;
              case 22:
                         anOptimist = 1; expAbilities[i] = 1;
                         break;
             case 23:    
                         mortSpecial = mortSpecial + descrTxt[8][17] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
             case 24:    
                         mortSpecial = mortSpecial + descrTxt[8][18] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 25:
                         resultTxt = &#39;&lt;font size = &#34;4&#34;&gt;&#39; + resultTxt + &#39;&lt;/font&gt;&#39;;
                         break;
              case 26:
                         for (k=0;k&lt;descrTxt[6].length;k++){
                             resultTxt = resultTxt.replace(new RegExp(descrTxt[6][k], &#39;g&#39;), descrTxt[6][k] + descrTxt[6][k].substr(0,1) ); 
                         }
                         break;
              case 27:
                         resultTxt = &#39;&lt;font color = &#34;#660000&#34;&gt;&#39; + resultTxt + &#39;&lt;/font&gt;&#39;;
                         break;
             case 28:    
                         mortSpecial = mortSpecial + descrTxt[8][19] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 29:
                         document.getElementById(&#34;cap1&#34;).innerHTML = document.getElementById(&#34;cap1&#34;).innerHTML.replace(dName,interfaceText[71]);  
                         interfaceText[21] = interfaceText[21].replace(dName,interfaceText[79]); 
                         interfaceText[21] = interfaceText[21].replace(interfaceText[80],interfaceText[79]); 
                         interfaceText[21] = interfaceText[21].replace(interfaceText[81],interfaceText[80]); 
                         //for (k=0; k&lt;descrTxt.length; k++) { descrTxt[k] = descrTxt[k].replace(dName,interfaceText[71]); }
                         for (k=0; k&lt;interfaceText.length; k++) { interfaceText[k] = interfaceText[k].replace(dName,interfaceText[71]); }
                         noRefresh = 1; setInterface(); 
                         dName = interfaceText[71]; expAbilities[i] = 1;
                         break;
              case 30:
                         resultTxt = resultTxt.replace(new RegExp(&#39;#......&#39;, &#39;g&#39;), &#39;#cca300&#39; ); 
                         break;
              case 31:
                         resultTxt = resultTxt.replace(new RegExp(&#39;#ff0000&#39;, &#39;g&#39;), &#39;#006600&#39; ); 
                         break;
              case 32:
                         deathProtected = 1; expAbilities[i] = 1;
                         break;
              case 33:
                         resultTxt = resultTxt.replace(new RegExp(descrTxt[7][0], &#39;gi&#39;), function retE(x){ if(Math.random()&gt;0.2){x=descrTxt[7][0]}else{x=descrTxt[7][1]}; return x;  } ); 
                         for (k=0; k&lt;descrTxt[6].length; k++){
                              resultTxt = resultTxt.replace(new RegExp(descrTxt[6][k].substr(0,1) + &#39; &#39;, &#39;g&#39;), descrTxt[6][k].substr(0,1) + descrTxt[7][2] + &#39; &#39; ); 
                         } expAbilities[i] = 1;
                         break;
              case 34:
                         resultTxt = resultTxt.toUpperCase();
                         //resultTxt = resultTxt.replace(&#39;. &#39;, &#39;! &#39; ); 
                         break;
             case 35:    
                         mortSpecial = mortSpecial + descrTxt[8][20] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 36:
                         resultTxt = &#39;&lt;span style=&#34;background-color:#99ff99&#34;&gt;&#39; + resultTxt + &#39;&lt;/span&gt;&#39;;
                         break;
             case 37:    
                         mortSpecial = mortSpecial + descrTxt[8][21] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
             case 38:    
                         mortSpecial = mortSpecial + descrTxt[8][22] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 39:
                         for (k=0;k&lt;descrTxt[5][0].length;k++){
                            resultTxt = resultTxt.replace(interfaceText[65] + descrTxt[5][0][k], interfaceText[65] + descrTxt[5][0][k] + &#39;&lt;font color =&#34;#ffd633&#34;&gt;&#39;+descrTxt[5][2][Math.floor((Math.random() * descrTxt[5][2].length) + 0)] + descrTxt[5][0][k] + &#39;&lt;/font&gt;&#39;); 
                         }
                         resultTxt = resultTxt.replace(interfaceText[66] ,interfaceText[67]); 
                         break;
              case 40:
                         resultTxt = resultTxt.replace(new RegExp(descrTxt[7][3], &#39;gi&#39;), function retE(x){ if(Math.random()&gt;0.2){x=descrTxt[7][3]}else{x=descrTxt[7][4]}; return x;  } ); 
                         resultTxt = resultTxt.replace(new RegExp(descrTxt[7][5], &#39;gi&#39;), function retE(x){ if(Math.random()&gt;0.2){x=descrTxt[7][5]}else{x=descrTxt[7][6]}; return x;  } ); 
                         break;
              case 41:
                         theBuff = 1.2; expAbilities[i] = 1;
                         break;
              case 42: 
                         mortSpecial = mortSpecial + descrTxt[8][0] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 43: 
                         money = money + Math.round( Math.random()*3000 + 1);  document.getElementById(&#34;score11&#34;).innerHTML = money; expAbilities[i] = 1;
                         break;
              case 44: 
                         stats[0]=stats[0]+5; stats[2]=stats[2]-20; setStats(); expAbilities[i] = 1;
                         break;
              case 45: 
                         mortSpecial = mortSpecial + descrTxt[8][1] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 46: 
                         for (k=0;k&lt;7;k++) { interfaceText[7+k] = descrTxt[9][0+k]; } noRefresh = 1; setInterface(); expAbilities[i] = 1;
                         break;
              case 47: 
                         isMilitary = 1; expAbilities[i] = 1;
                         break;
              case 48: 
                         mortSpecial = mortSpecial + descrTxt[8][2] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 49: 
                         resultTxt = resultTxt.replace(new RegExp(descrTxt[7][7], &#39;gi&#39;) ,descrTxt[7][8]); 
                         break;
              case 50: 
                         resultTxt = resultTxt.replace(new RegExp(descrTxt[7][9], &#39;gi&#39;) ,descrTxt[7][10]); 
                         break;
              case 51: 
                         document.getElementById(&#34;cap1&#34;).innerHTML = document.getElementById(&#34;cap1&#34;).innerHTML.replace(dName,interfaceText[74]);  
                         interfaceText[21] = interfaceText[21].replace(dName,interfaceText[81]); 
                         interfaceText[21] = interfaceText[21].replace(interfaceText[79],interfaceText[81]); 
                         interfaceText[21] = interfaceText[21].replace(interfaceText[80],interfaceText[81]); 
                         //for (k=0; k&lt;descrTxt.length; k++) { descrTxt[k] = descrTxt[k].replace(dName,interfaceText[74]); }
                         for (k=0; k&lt;interfaceText.length; k++) { interfaceText[k] = interfaceText[k].replace(dName,interfaceText[74]); }
                         noRefresh = 1; setInterface(); 
                         dName = interfaceText[74]; expAbilities[i] = 1;
                         break;
              case 52: 
                         resultTxt = resultTxt.replace(new RegExp(&#39;, &#39;, &#39;g&#39;), function retE(x){ if(Math.random()&gt;0.2){x=&#39;, &#39;}else{x=interfaceText[75] + &#39;, &#39;}; return x;  } ); 
                         break;
              case 53: 
                         mortSpecial = mortSpecial + descrTxt[8][3] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 54: 
                         mortSpecial = mortSpecial + descrTxt[8][4] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 55:
                         document.getElementById(&#34;cap1&#34;).innerHTML = document.getElementById(&#34;cap1&#34;).innerHTML.replace(dName,interfaceText[76]);  
                         interfaceText[21] = interfaceText[21].replace(dName,interfaceText[80]); 
                         interfaceText[21] = interfaceText[21].replace(interfaceText[79],interfaceText[80]); 
                         interfaceText[21] = interfaceText[21].replace(interfaceText[81],interfaceText[80]); 
                         for (k=0; k&lt;interfaceText.length; k++) { interfaceText[k] = interfaceText[k].replace(dName,interfaceText[76]); }
                         //for (k=0; k&lt;descrTxt.length; k++) { descrTxt[k] = descrTxt[k].replace(dName,interfaceText[76]); }
                         noRefresh = 1; setInterface(); 
                         dName = interfaceText[76]; expAbilities[i] = 1;
                         break;
              case 56: 
                         mortSpecial = mortSpecial + descrTxt[8][5] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 57: 
                         document.getElementById(&#34;pic1&#34;).src =&#39;&#39;; expAbilities[i] = 1;
                         break;
              case 58: 
                         mortSpecial = mortSpecial + descrTxt[8][6] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 59: 
                         mortSpecial = mortSpecial + descrTxt[8][7] + &#39;.&lt;br&gt;&lt;br&gt; &#39;; expAbilities[i] = 1;
                         break;
              case 60: 
                         for (k=0;k&lt;descrTxt[5][0].length;k++){
                            resultTxt = resultTxt.replace(interfaceText[65] + descrTxt[5][0][k], interfaceText[65] + descrTxt[5][0][k] + &#39;&lt;font color =&#34;#80bfff&#34;&gt;&#39;+descrTxt[5][3][Math.floor((Math.random() * descrTxt[5][3].length) + 0)] + descrTxt[5][0][k] + &#39;&lt;/font&gt;&#39;); 
                         }
                         resultTxt = resultTxt.replace(interfaceText[66] ,interfaceText[67]); 
              case 61: 
                         specPoints = specPoints + 5; setStats(); expAbilities[i] = 1;
                         break;
              case 62: 
                         for (k=0;k&lt;7;k++) { specs[k] = 0; } stats[0] = stats[0] - 1; setStats(); expAbilities[i] = 1;
                         break;
              case 63: 
                         specPoints = specPoints + 2; setStats(); expAbilities[i] = 1;
                         break;
              case 64: 
                         newName = &#39;&lt;font color = &#34;#ff0000&#34;&gt;&#39; + dName.substr(0,1) + &#39;&lt;/font&gt;&#39; + 
    					         &#39;&lt;font color = &#34;#ff6600&#34;&gt;&#39; + dName.substr(1,1) + &#39;&lt;/font&gt;&#39; +
    							 &#39;&lt;font color = &#34;#cccc00&#34;&gt;&#39; + dName.substr(2,1) + &#39;&lt;/font&gt;&#39; +
    							 &#39;&lt;font color = &#34;#009900&#34;&gt;&#39; + dName.substr(3,1) + &#39;&lt;/font&gt;&#39; +
    							 &#39;&lt;font color = &#34;#0000ff&#34;&gt;&#39; + dName.substr(4,1) + &#39;&lt;/font&gt;&#39; +
    							 &#39;&lt;font color = &#34;#990099&#34;&gt;&#39; + dName.substr(5,1) + &#39;&lt;/font&gt;&#39;;
    					 addName = dName.substr(6,dName.length-6);
    					 dName = dName.substr(0,6);
                         for (k=0; k&lt;interfaceText.length; k++) { interfaceText[k] = interfaceText[k].replace(dName,newName); }
    					 for (k=0; k&lt;randomChecks.length; k++) { 
    					   for (l=3; l&lt;randomChecks[k].length; l++) { 
    					    randomChecks[k][l] = randomChecks[k][l].replace(dName, &#39;D-7777&#39;); 
    					   }
    					 }
                         dName = newName + addName;
                         noRefresh = 1; setInterface(); expAbilities[i] = 1;
                         break;						 
    					 
        }//switch


      }//if
               
    }


      document.getElementById(&#34;Tfield&#34;).innerHTML = resultTxt;



 //describe conditions
 for (i=0; i&lt;subjCon.length; i++){
   
   if (subjCon[i] != &#39;&#39;) {
      subjTxt = subjTxt + &#39;&lt;b&gt;&lt;font color=&#34;#000099&#34;&gt;&#39; + subjCon[i] + &#39;&lt;/font&gt;&lt;/b&gt;, &#39;;
   }
   
 }
 subjTxt = subjTxt.substr(0,subjTxt.length-2)  + &#39;.&#39;;


 //add achievements
 for (i=0; i&lt;curAch.length; i++){

      subjTxt = subjTxt + &#39;&lt;br&gt;&#39; + greatAchievements[curAch[i]] + &#39;.&#39; ;
   
 }
 
 document.getElementById(&#34;Ofield&#34;).innerHTML = interfaceText[23] + subjTxt;



      //manual resize
      if (document.getElementById(&#34;CCd3&#34;).offsetHeight + document.getElementById(&#34;Ofield&#34;).offsetHeight    &gt; document.getElementById(&#34;CCd&#34;).offsetHeight -45 ){

         //document.getElementById(&#34;CCd&#34;).style.height = (document.getElementById(&#34;CCd3&#34;).offsetHeight + document.getElementById(&#34;Ofield&#34;).offsetHeight  + 45) + &#34;px&#34;;
          document.getElementById(&#34;CCd2&#34;).style.height  = (document.getElementById(&#34;CCd3&#34;).offsetHeight + document.getElementById(&#34;Ofield&#34;).offsetHeight  + 45) + &#34;px&#34;;
      } else {

         document.getElementById(&#34;CCd2&#34;).style.height = (CCd0-20) + &#34;px&#34;;
         document.getElementById(&#34;CCd&#34;).style.height =CCd0 + &#34;px&#34;;
      }

   resultTxt = &#39;&#39;;

}
                                                                               





                                                               //Random encounters

function getRandomCheck(){

    strMod = 1 - (100 - specs[0] * 7.5) / 100;

    //shuffle
    //for(var j, x, i = critStatsCheck.length; i; j = Math.floor(Math.random() * i), x = critStatsCheck[--i], critStatsCheck[i] = critStatsCheck[j], critStatsCheck[j] = x);

    checksArray = [];
    	
    for(checkId = 0; checkId &lt; randomChecks.length; checkId++) {
  
        ranChance = 0.5;
    	badStats = 0;
    	
        //if stats are critical, increase chance of dying check
        if (checkId == critStatsCheck[0][3] &amp;&amp; stats[critStatsCheck[0][0]] &lt;= critStatsCheck[0][1]) { badStats = badStats + 1; } 
        if (checkId == critStatsCheck[1][3] &amp;&amp; stats[critStatsCheck[1][0]] &gt;= critStatsCheck[1][1]) { badStats = badStats + 1; }
    	if (checkId == critStatsCheck[2][3] &amp;&amp; stats[critStatsCheck[2][0]] &gt;= critStatsCheck[2][1]) { badStats = badStats + 1; }
   
        //if saved by strMod
        if (badStats &gt; 0 &amp;&amp; badStats * Math.random() &lt; strMod ) {
             ranChance = 0; 
    		 resultTxt = resultTxt + interfaceText[47] + &#39;&lt;br&gt;&#39;; 
    	} else {
    	     ranChance = 0.75; 
    	}
    	
   
        if( Math.random() &lt; ranChance &amp;&amp;
    	    stats[randomChecks[checkId][0]]&gt;= randomChecks[checkId][1] &amp;&amp; 
    	    stats[randomChecks[checkId][0]]&lt;= randomChecks[checkId][2] ){
    		
    		checksArray.push(checkId);
    	}	
    }
    	
        if (checksArray.length &gt; 0) {
    	
    	    //choose only one of all allowed
    	    checkId = checksArray[Math.floor((Math.random() * checksArray.length) + 0)]; 
    		
//checkId = 0; //Test		

     		resultTxt = resultTxt  + &#39;&lt;br&gt;&lt;br&gt;&#39; + interfaceText[31] + randomChecks[checkId][3] + &#39;&lt;br&gt;&#39;;   
      
            chaMod = (10 - 0.5 * specs[3])/10;   

            lucMod = (10 + specs[6]*4)/30;

            aHp = Math.round(Math.random()*specs[0]/1.5) + 1; 
            aHg = -1*Math.round(Math.random()*specs[2]*5) - 1; 
    		aTh = -1*Math.round(Math.random()*specs[2]*5) - 1; 

    		switch(checkId){
    		   case 0:  resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.floor((Math.random() * (stats[0]+2) * lucMod) + 0) &lt; 1){  
    						   resultTxt = resultTxt  +  randomChecks[checkId][5] 
    						   isDead = 1;
    					  }  else {
    						  resultTxt = resultTxt  +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    						  deathEvaded = deathEvaded +1;
    					  }    break;
    		   case 1:  resultTxt = resultTxt.substr(0,resultTxt.length-4);
    		            if(Math.random() &gt; chaMod ){  
    		                resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
     						stats[0] = stats[0] + aHp; 
         					stats[1] = stats[1] + aHg; 
    				    }  else {
    					    aHp = Math.round(aHp/2);
    						aHg = Math.round(aHg/2);
    					    resultTxt = resultTxt + randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
     						stats[0] = stats[0] + aHp; 
         					stats[1] = stats[1] + aHg; 						
    					}     break;
    		   case 2:   resultTxt = resultTxt.substr(0,resultTxt.length-4);
                         if(Math.random() &gt; chaMod + 0.3){  
    						  resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&#39;;
    						  money = money - 100000
    						  addAchievement(4); 
    					  }  else {
    						  money = money - 300
    						  resultTxt = resultTxt  +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    					  }    break;
    		   case 3:  resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.random() &gt; chaMod){  
    						  resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
    					  } else{
    						  addCondition( condTxt[1][0]);
    						  resultTxt = resultTxt  +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    					  } break;
    		   case 4: resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.random() &gt; chaMod){  
    						  resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
    						  checkSpecial();
    					  } else{
    						  resultTxt = resultTxt  +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    					  } break;
    		   case 5: resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.random() &gt; chaMod){  
    						  resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
    						  checkSpecial();
    					  } else{
    						  resultTxt = resultTxt  +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    					  } break;
    		   case 6:  resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.random() &gt; chaMod){  
    						  addCondition( condTxt[2][0]);
    						  resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
    						  stats[1] = stats[1] + aHg; 
    					  } else{
    						  resultTxt = resultTxt +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    					  } break;
    		   case 7:  resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.random() &gt; chaMod){  
    						  aHg = 2*aHg; 
    						  aHp = -1*aHp; 
    						  resultTxt = resultTxt + randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;

    						  stats[0] = stats[0] + aHp; 
    						  stats[1] = stats[1] + aHg; 
    					  } else{
    						  aHp = -1*Math.round(Math.random()*11/(specs[0]+1)); 
    						  resultTxt = resultTxt +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;

    						  stats[0] = stats[0] + aHp; 
    						  stats[1] = stats[1] + aTh; 
    					  } break; 
    		   case 8:  resultTxt = resultTxt.substr(0,resultTxt.length-4); 
    					  if(Math.random() &gt; chaMod + 0.3){  

    						  addAchievement(0);

    						  resultTxt = resultTxt + randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;

    						  stats[1] = stats[1] + aHg; 
    						  stats[2] = stats[2] + aTh; 

    					  } else{


    						  resultTxt =  resultTxt +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    						 
    					  } break;
    		   case 9: resultTxt = resultTxt.substr(0,resultTxt.length-4); 
    					  if(Math.floor((Math.random() * (300 - stats[1]+2) * lucMod) + 0) &lt; 1){  
    						   resultTxt = resultTxt  +  randomChecks[checkId][5] 
    						   isDead = 2;

    					  }  else {
    						  resultTxt = resultTxt  +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    						  deathEvaded = deathEvaded +1;
    						  stats[1] = stats[1] + aHg; 
    						  stats[2] = stats[2] + aTh; 
    					  }    break;
    					  
    		   case 10:  resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.random() &gt; chaMod){ 
    						  resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
    						  stats[2] = stats[2] + aHp; 
    					  } else{
    						  aHp = aHp * -1;
    						  resultTxt = resultTxt +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    						  stats[0] = stats[0] + aHp; 
    					  } break;
    		   case 11:  resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.random() &gt; chaMod){  
    						  resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
    						  addCondition( condTxt[3][0]); 
    						  stats[0] = stats[0] + aHp; 
    						  stats[2] = stats[2] + aTh; 
    					  } else{
    						  resultTxt = resultTxt +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    						  stats[1] = stats[1] + aHg; 
    					  } break;
    		   case 12:  resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.random() &gt; chaMod){  
    						  resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
    						  checkSpecial();
    					  } else{
    						  aHp = aHp * -1;
    						  resultTxt = resultTxt +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    						  stats[0] = stats[0] + aHp; 
    						  stats[1] = stats[1] + aHg; 
    						  stats[2] = stats[2] + aTh; 

    					  } break;
    		   case 13:  resultTxt = resultTxt.substr(0,resultTxt.length-4);
    					  if(Math.random() &gt; chaMod){  
    						  resultTxt = resultTxt  +  randomChecks[checkId][5] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
    						  stats[2] = stats[2] + aTh; 
    					  } else{
    						  resultTxt = resultTxt +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    						  stats[1] = stats[1] + aHg; 

    						  if(specs[3]&gt;=5){ addAchievement(3); }
    					  } break;
    		   case 14: resultTxt = resultTxt.substr(0,resultTxt.length-4); 
    					  if(Math.floor((Math.random() * (300 - stats[2]+2) * lucMod) + 0) &lt; 1){  
    						   resultTxt = resultTxt  +  randomChecks[checkId][5] 
    						   isDead = 3;

    					  }  else {
    						  resultTxt = resultTxt  +  randomChecks[checkId][4] + &#39;&lt;br&gt;&#39;;
    						  deathEvaded = deathEvaded +1;
    						  stats[1] = stats[1] + aHg;
    					  }    break;

    		} //switch

            if (aHp &lt;0) { repCol = &#39;&lt;font color=#ff0000&gt;&#39; } else { repCol = &#39;&lt;font color=#006600&gt;+&#39; }
    		resultTxt = resultTxt.replace(&#39;:hp:&#39;,repCol + aHp + &#39;&lt;/font&gt;&#39;);

    		if (aHg &gt;0) { repCol = &#39;&lt;font color=#ff0000&gt;+&#39; } else { repCol = &#39;&lt;font color=#006600&gt;&#39; }
    		resultTxt = resultTxt.replace(&#39;:hg:&#39;,repCol + aHg + &#39;&lt;/font&gt;&#39;);

    		if (aTh &gt;0) { repCol = &#39;&lt;font color=#ff0000&gt;+&#39; } else { repCol = &#39;&lt;font color=#006600&gt;&#39; }
    		resultTxt = resultTxt.replace(&#39;:th:&#39;,repCol + aTh + &#39;&lt;/font&gt;&#39;);


        } //if stats ok
    

}


function addAchievement(ind){

                      isUsed = 0;
                      for(k=0; k&lt;curAch.length; k++){
                         if (curAch[k] == ind){isUsed = 1;}
                      }  
                      if ( isUsed == 0) {   curAch.push(ind); }
}

function addCondition(condTxt){ 

                      isUsed = 0;
                      for(k=0; k&lt;subjCon.length; k++){
                         if (subjCon[k] == condTxt){isUsed = 1;}
                      }  
                      if ( isUsed == 0) {   subjCon.push(condTxt); }
}


function setStats(){


   if (specPoints &lt; 0) { specPoints = 0; }

   if (stats[0] &gt; 100) { stats[0] = 100; }
 for (i=0; i&lt;stats.length; i++){
   if (stats[i] &lt; 0) { stats[i] = 0; }
   if (stats[i] &gt; 300) { stats[i] = 300; }
    document.getElementById(&#34;stat1&#34;+(i+1).toString()).innerHTML =  stats[i]; 
 };
 
 if (stats[0] &lt;= 0) { stats[0] = 1; }
 
 if (stats[0] &gt;= 95){ document.getElementById(&#34;stat11&#34;).innerHTML =   &#39;&lt;font color = &#34;#009900&#34;&gt;&#39; + stats[0] + &#39;&lt;/font&gt;&#39; + &#39;/100&#39;; } 
 if (stats[0] &lt;   95){ document.getElementById(&#34;stat11&#34;).innerHTML =   &#39;&lt;font color = &#34;#006600&#34;&gt;&#39; + stats[0] + &#39;&lt;/font&gt;&#39; + &#39;/100&#39;; } 
 if (stats[0] &lt;= 75 ){ document.getElementById(&#34;stat11&#34;).innerHTML =   &#39;&lt;font color = &#34;#FFCC00&#34;&gt;&#39; + stats[0] + &#39;&lt;/font&gt;&#39; + &#39;/100&#39;; } 
 if (stats[0] &lt;= 50 ){ document.getElementById(&#34;stat11&#34;).innerHTML =   &#39;&lt;font color = &#34;#FF6600&#34;&gt;&#39; + stats[0] + &#39;&lt;/font&gt;&#39; + &#39;/100&#39;; } 
 if (stats[0] &lt;= 25 ){ document.getElementById(&#34;stat11&#34;).innerHTML =   &#39;&lt;font color = &#34;#FF0000&#34;&gt;&#39; + stats[0] + &#39;&lt;/font&gt;&#39; + &#39;/100&#39;; } 

 if (stats[1] &gt;= 280){ document.getElementById(&#34;stat12&#34;).innerHTML =   &#39;&lt;font color = &#34;#FF0000&#34;&gt;&#39; + stats[1] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 
 if (stats[1] &lt;   280){ document.getElementById(&#34;stat12&#34;).innerHTML =   &#39;&lt;font color = &#34;#993300&#34;&gt;&#39; + stats[1] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 
 if (stats[1] &lt;= 210 ){ document.getElementById(&#34;stat12&#34;).innerHTML =   &#39;&lt;font color = &#34;#996600&#34;&gt;&#39; + stats[1] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 
 if (stats[1] &lt;= 140 ){ document.getElementById(&#34;stat12&#34;).innerHTML =   &#39;&lt;font color = &#34;#999900&#34;&gt;&#39; + stats[1] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 
 if (stats[1] &lt;= 70 ){ document.getElementById(&#34;stat12&#34;).innerHTML =   &#39;&lt;font color = &#34;#009900&#34;&gt;&#39; + stats[1] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 

 if (stats[2] &gt;= 280){ document.getElementById(&#34;stat13&#34;).innerHTML =   &#39;&lt;font color = &#34;#FF0000&#34;&gt;&#39; + stats[2] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 
 if (stats[2] &lt;   280){ document.getElementById(&#34;stat13&#34;).innerHTML =   &#39;&lt;font color = &#34;#993300&#34;&gt;&#39; + stats[2] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 
 if (stats[2] &lt;= 210 ){ document.getElementById(&#34;stat13&#34;).innerHTML =   &#39;&lt;font color = &#34;#996600&#34;&gt;&#39; + stats[2] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 
 if (stats[2] &lt;= 140 ){ document.getElementById(&#34;stat13&#34;).innerHTML =   &#39;&lt;font color = &#34;#999900&#34;&gt;&#39; + stats[2] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 
 if (stats[2] &lt;= 70 ){ document.getElementById(&#34;stat13&#34;).innerHTML =   &#39;&lt;font color = &#34;#009900&#34;&gt;&#39; + stats[2] + &#39;&lt;/font&gt;&#39; + &#39;/300&#39;; } 



 for (i=0; i&lt;specs.length; i++){
   if (specs[i] &lt; 0) { specs[i] = 0; }
   if (specs[i] &gt; 10) { specs[i] = 10; }

   switch(specs[i]){
     case 0:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#FF0000&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 1:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#cc2900&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 2:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#991f00&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 3:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#661400&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 4:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#4d0f00&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 5:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#000000&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 10: document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#33cc33&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 9:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#009933&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 8:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#009900&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 7:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#006600&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
     case 6:  document.getElementById(&#34;spec1&#34;+(i+1).toString()).innerHTML = &#39;&lt;font color = &#34;#003300&#34;&gt;&#39; + specs[i] + &#39;&lt;/color&gt;&#39;;   break;
   };

 };


   if(stats[0] - stats[1] - stats[2] &lt;= 100){ subjCon[0] = condTxt[0][0] }
   if(stats[0] - stats[1] - stats[2] &lt;= 30){ subjCon[0] = condTxt[0][1] }
   if(stats[0] - stats[1] - stats[2] &lt;= -40){ subjCon[0] = condTxt[0][2] }
   if(stats[0] - stats[1] - stats[2] &lt;= -110){ subjCon[0] = condTxt[0][3] }
   if(stats[0] - stats[1] - stats[2] &lt;= -180){ subjCon[0] = condTxt[0][4] }
   if(stats[0] - stats[1] - stats[2] &lt;= -250){ subjCon[0] = condTxt[0][5] }
   if(stats[0] - stats[1] - stats[2] &lt;= -320){ subjCon[0] = condTxt[0][6] }
   if(stats[0] - stats[1] - stats[2] &lt;= -390){ subjCon[0] = condTxt[0][7] }
   if(stats[0] - stats[1] - stats[2] &lt;= -460){ subjCon[0] = condTxt[0][8] }
   if(stats[0] - stats[1] - stats[2] &lt;= -530){ subjCon[0] = condTxt[0][9] }
   
   if (isDead &gt; 0) {  subjCon[0] = condTxt[0][10] }
   if (isRunAway &gt; 0) {  subjCon[0] = condTxt[0][11] }

   
   noRefresh = 1; setInterface();

}


function minStat(ind) {

 if (specs[ind]&gt;1) {
  specPoints = specPoints + 1;
  specs[ind] = specs[ind] - 1;
  setStats();
 }

}




function setInterface(){
 var addMin = &#39;&#39;;
 var addMax = &#39;&#39;;

 document.getElementById(&#34;introTxt&#34;).innerHTML = interfaceText[0];
 document.getElementById(&#34;cap1&#34;).innerHTML = interfaceText[1];
 document.getElementById(&#34;cap2&#34;).innerHTML = interfaceText[2];
 document.getElementById(&#34;stat01&#34;).innerHTML = interfaceText[3];
 document.getElementById(&#34;stat02&#34;).innerHTML = interfaceText[4];
 document.getElementById(&#34;stat03&#34;).innerHTML = interfaceText[5];
 document.getElementById(&#34;score01&#34;).innerHTML = interfaceText[6];
  if (specPoints &gt;0 &amp;&amp; specs[0] &lt; 9) { addMax = &#39;(&#39; +&#39;&lt;a href=&#34;#&#34; onclick=&#34;if(specs[0]&lt;9 &amp;&amp; specPoints&gt;0){specs[0]++; specPoints--; setStats(); }&#34; &gt;&lt;b&gt;+&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&amp;nbsp&#39; } else { addMax = &#39;&#39;}
  if (step == 0 &amp;&amp; specs[0] &gt; 1) {addMin = &#39;&amp;nbsp(&#39; +&#39;&lt;a href=&#34;#&#34; style=&#34;color: rgb(0,0,255)&#34; onclick=&#34;minStat(0);&#34;&gt;&lt;b&gt;-&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&#39;} else {addMin = &#39;&#39;;}
 document.getElementById(&#34;spec01&#34;).innerHTML = addMax + interfaceText[7] + addMin; 
 document.getElementById(&#34;spec01&#34;).title =  interfaceText[38];
  if (specPoints &gt;0 &amp;&amp; specs[1] &lt; 9) { addMax = &#39;(&#39; +&#39;&lt;a href=&#34;#&#34; onclick=&#34;if(specs[1]&lt;9 &amp;&amp; specPoints&gt;0){specs[1]++; specPoints--; setStats(); }&#34; &gt;&lt;b&gt;+&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&amp;nbsp&#39; } else { addMax = &#39;&#39;}
  if (step == 0 &amp;&amp; specs[1] &gt; 1) {addMin = &#39;&amp;nbsp(&#39; +&#39;&lt;a href=&#34;#&#34; style=&#34;color: rgb(0,0,255)&#34; onclick=&#34;minStat(1);&#34;&gt;&lt;b&gt;-&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&#39;} else {addMin = &#39;&#39;;}
 document.getElementById(&#34;spec02&#34;).innerHTML = addMax + interfaceText[8] + addMin;
 document.getElementById(&#34;spec02&#34;).title =  interfaceText[39];
  if (specPoints &gt;0 &amp;&amp; specs[2] &lt; 9) { addMax = &#39;(&#39; +&#39;&lt;a href=&#34;#&#34; onclick=&#34;if(specs[2]&lt;9 &amp;&amp; specPoints&gt;0){specs[2]++; specPoints--; setStats(); }&#34; &gt;&lt;b&gt;+&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&amp;nbsp&#39; } else { addMax = &#39;&#39;}
  if (step == 0 &amp;&amp; specs[2] &gt; 1) {addMin = &#39;&amp;nbsp(&#39; +&#39;&lt;a href=&#34;#&#34; style=&#34;color: rgb(0,0,255)&#34; onclick=&#34;minStat(2);&#34;&gt;&lt;b&gt;-&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&#39;} else {addMin = &#39;&#39;;}
 document.getElementById(&#34;spec03&#34;).innerHTML = addMax + interfaceText[9] + addMin;
 document.getElementById(&#34;spec03&#34;).title =  interfaceText[40];
  if (specPoints &gt;0 &amp;&amp; specs[3] &lt; 9) { addMax = &#39;(&#39; +&#39;&lt;a href=&#34;#&#34; onclick=&#34;if(specs[3]&lt;9 &amp;&amp; specPoints&gt;0){specs[3]++; specPoints--; setStats(); }&#34; &gt;&lt;b&gt;+&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&amp;nbsp&#39; } else { addMax = &#39;&#39;}
  if (step == 0 &amp;&amp; specs[3] &gt; 1) {addMin = &#39;&amp;nbsp(&#39; +&#39;&lt;a href=&#34;#&#34; style=&#34;color: rgb(0,0,255)&#34; onclick=&#34;minStat(3);&#34;&gt;&lt;b&gt;-&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&#39;} else {addMin = &#39;&#39;;}
 document.getElementById(&#34;spec04&#34;).innerHTML = addMax + interfaceText[10] + addMin;
 document.getElementById(&#34;spec04&#34;).title =  interfaceText[41];
  if (specPoints &gt;0 &amp;&amp; specs[4] &lt; 9) { addMax = &#39;(&#39; +&#39;&lt;a href=&#34;#&#34; onclick=&#34;if(specs[4]&lt;9 &amp;&amp; specPoints&gt;0){specs[4]++; specPoints--; setStats(); }&#34; &gt;&lt;b&gt;+&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&amp;nbsp&#39; } else { addMax = &#39;&#39;}
  if (step == 0 &amp;&amp; specs[4] &gt; 1) {addMin = &#39;&amp;nbsp(&#39; +&#39;&lt;a href=&#34;#&#34; style=&#34;color: rgb(0,0,255)&#34; onclick=&#34;minStat(4);&#34;&gt;&lt;b&gt;-&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&#39;} else {addMin = &#39;&#39;;}
 document.getElementById(&#34;spec05&#34;).innerHTML = addMax + interfaceText[11] + addMin;
 document.getElementById(&#34;spec05&#34;).title =  interfaceText[42]
  if (specPoints &gt;0 &amp;&amp; specs[5] &lt; 9) { addMax = &#39;(&#39; +&#39;&lt;a href=&#34;#&#34; onclick=&#34;if(specs[5]&lt;9 &amp;&amp; specPoints&gt;0){specs[5]++; specPoints--; setStats(); }&#34; &gt;&lt;b&gt;+&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&amp;nbsp&#39; } else { addMax = &#39;&#39;}
  if (step == 0 &amp;&amp; specs[5] &gt; 1) {addMin = &#39;&amp;nbsp(&#39; +&#39;&lt;a href=&#34;#&#34; style=&#34;color: rgb(0,0,255)&#34; onclick=&#34;minStat(5);&#34;&gt;&lt;b&gt;-&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&#39;} else {addMin = &#39;&#39;;}
 document.getElementById(&#34;spec06&#34;).innerHTML = addMax + interfaceText[12] + addMin;
 document.getElementById(&#34;spec06&#34;).title =  interfaceText[43];
  if (specPoints &gt;0 &amp;&amp; specs[6] &lt; 9) { addMax = &#39;(&#39; +&#39;&lt;a href=&#34;#&#34; onclick=&#34;if(specs[6]&lt;9 &amp;&amp; specPoints&gt;0){specs[6]++; specPoints--; setStats(); }&#34; &gt;&lt;b&gt;+&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&amp;nbsp&#39; } else { addMax = &#39;&#39;}
  if (step == 0 &amp;&amp; specs[6] &gt; 1) {addMin = &#39;&amp;nbsp(&#39; +&#39;&lt;a href=&#34;#&#34; style=&#34;color: rgb(0,0,255)&#34; onclick=&#34;minStat(6);&#34;&gt;&lt;b&gt;-&lt;/b&gt;&lt;/a&gt;&#39; + &#39;)&#39;} else {addMin = &#39;&#39;;}
 document.getElementById(&#34;spec07&#34;).innerHTML = addMax + interfaceText[13] + addMin;
 document.getElementById(&#34;spec07&#34;).title =  interfaceText[44];
 document.getElementById(&#34;yesBtn&#34;).innerHTML = interfaceText[14];
 document.getElementById(&#34;noBtn&#34;).innerHTML = interfaceText[15];
 document.getElementById(&#34;aBtn1&#34;).innerHTML = interfaceText[16];
 document.getElementById(&#34;aBtn2&#34;).innerHTML = interfaceText[17];
 document.getElementById(&#34;aBtn3&#34;).innerHTML = interfaceText[18];
 document.getElementById(&#34;aBtn4&#34;).innerHTML = interfaceText[19];
 document.getElementById(&#34;aBtn5&#34;).innerHTML = interfaceText[20];
 document.getElementById(&#34;butTxt&#34;).innerHTML = interfaceText[21];
 document.getElementById(&#34;pic1&#34;).src = descrTxt[0][dPic];
 document.getElementById(&#34;step01&#34;).innerHTML = interfaceText[26];
 document.getElementById(&#34;theEndBtn&#34;).innerHTML = interfaceText[35];


   if (specPoints &gt;0) {

      document.getElementById(&#34;cap2&#34;).innerHTML = interfaceText[2] +
       interfaceText[50].replace(&#39;:spec:&#39;,  &#39;&lt;font color=#0000ff&gt;&lt;b&gt;&#39; + specPoints + &#39;&lt;/b&gt;&lt;/font&gt;&#39;);

   }

 if (noRefresh == 0) { nextStep(0); }else{ noRefresh =0; }
}

function changeLan() {

alert(&#39;Sorry guys, under construction. Maybe later... Now too lazy, kek.&#39;);

 if (document.getElementById(&#34;chanL&#34;).innerHTML == &#39;Eng&#39;){
  document.getElementById(&#34;chanL&#34;).innerHTML = &#39;Rus&#39;;
  interfaceText = interface_en;
  theTexts = texts_en;
  eventTexts = eventTexts_en;
  condTxt = condTxt_en;
  randomChecks = randomChecks_en;
  greatAchievements = greatAchievements_en;
  descrTxt = descrTxt_en;
 } else {
  document.getElementById(&#34;chanL&#34;).innerHTML = &#39;Eng&#39;;
  interfaceText = interface_ru;
  theTexts = texts_ru;
  eventTexts = eventTexts_ru;
  condTxt = condTxt_ru;
  randomChecks = randomChecks_ru;
  greatAchievements = greatAchievements_en;
  descrTxt = descrTxt_en;
 }
 setInterface();
}

                                                                                                //YESNO
function yesNo(ind) {

 var spc = Math.floor((Math.random() * 7) + 0);

 document.getElementById(&#34;coinBtn&#34;).style.display = &#39;block&#39;;
 document.getElementById(&#34;trayBtn&#34;).style.display = &#39;none&#39;;


 if (ind == 0) {
    money = money - lastMoney;

    denyOfEating = denyOfEating + 1;
  
    dishes = dishes - 1;

    agiMod = (21 - specs[5]*2)/20;
    
    if (Math.random() &lt; agiMod){
       specs[ spc ] = specs[ spc ] - 1;

       resultTxt = resultTxt + interfaceText[27] + interfaceText[7 + spc] + interfaceText[28] + &#39;&lt;br&gt;&#39;;
    }

    intMod = (70 - specs[4] * 5) /100

      perMod = (90 + specs[1]*2)/100;
      addHp = Math.floor(perMod * Math.random()* 10 + 1);

      endMod = (90 + specs[2]*2)/100;
      addHg = -1* Math.floor(endMod * Math.random()* 30 + 1);
      addTh = -1* Math.floor(endMod * Math.random()* 30 + 1);

      resultTxt = resultTxt + interfaceText[45].replace(&#39;:hp:&#39;, &#39;&lt;font color = &#34;#006600&#34;&gt;+&#39; + addHp + &#39;&lt;/font&gt;&#39; ).replace(&#39;:hg:&#39;, &#39;&lt;font color = &#34;#006600&#34;&gt;&#39; + addHg + &#39;&lt;/font&gt;&#39; ) .replace(&#39;:th:&#39;, &#39;&lt;font color = &#34;#006600&#34;&gt;&#39; + addTh + &#39;&lt;/font&gt;&#39; )  + &#39;&lt;br&gt;&#39;;
      
      stats[0] = stats[0] + addHp;
      stats[1] = stats[1] + addHg;
      stats[2] = stats[2] + addTh;
      
     checkSpecial();

    if (Math.random() &lt; intMod){
      resultTxt = resultTxt + interfaceText[46] + &#39;&lt;br&gt;&#39;;
      totalScore = totalScore - 1;

      if( Math.random() * (denyOfEating)&gt;5) { isDead = 5; addAchievement(35); }

    } else {
      resultTxt = resultTxt + interfaceText[59] + &#39;&lt;br&gt;&#39;;
    }

 } else {
                                        //PRESSED YES

     addHp = 0;
     addHg = Math.floor((Math.random() * (randLims[pressedBtn][1]-randLims[pressedBtn][0])) + randLims[pressedBtn][0]);
     addTh = Math.floor((Math.random() * (randLims[pressedBtn][1]-randLims[pressedBtn][0])) + randLims[pressedBtn][0]);
     addSpec = [0,0,0,0,0,0,0];

     if (itemAbility&gt;0){addAchievement(40 + itemAbility);} //dynamic achievements

     //for item abilities
     

    resultTxt = resultTxt + theTexts[1][item][1][3] + &#39;.&lt;br&gt;&lt;br&gt;&#39;;

    if (theTexts[1][item][1][10] != &#39;&#39;) {addCondition(theTexts[1][item][1][10]);}
    
     
    addHp = addHp + theTexts[1][item][1][4];
    addHg = addHg + theTexts[1][item][1][5];
    addTh = addTh + theTexts[1][item][1][6];
      
    specAlt =  theTexts[1][item][7]; if (specAlt == 7){specAlt = Math.floor((Math.random() * 7) + 0);}
    
    if (specAlt == 8){ specPoints = specPoints + 1; } else {

        addSpec[specAlt] = addSpec[specAlt] + Math.floor( (Math.random() * (theTexts[1][item][1][9] - theTexts[1][item][1][8] + 1) ) + theTexts[1][item][1][8] );
    }


    //for prefix abilities
    for (k=0; k&lt;itemPrefixes.length; k++){

     
        if(theTexts[2][itemPrefixes[k]][1][3] != &#39;&#39;){ 

            resultTxt = resultTxt + theTexts[2][itemPrefixes[k]][1][3] + &#39;.&lt;br&gt;&#39;;
       
        }

        addHp = addHp + theTexts[2][itemPrefixes[k]][1][4];
        addHg = addHg + theTexts[2][itemPrefixes[k]][1][5];
        addTh = addTh + theTexts[2][itemPrefixes[k]][1][6];
      
        specAlt =  theTexts[2][itemPrefixes[k]][1][7]; if (specAlt == 7){specAlt = Math.floor((Math.random() * 7) + 0);}
        if (specAlt == 8){ specPoints = specPoints + 1; } else {

            addSpec[specAlt] = addSpec[specAlt] + Math.floor( (Math.random() * (theTexts[2][itemPrefixes[k]][1][9] - theTexts[2][itemPrefixes[k]][1][8] + 1) ) + theTexts[2][itemPrefixes[k]][1][8] );
        
    	}

    } //k  



    //for suffix abilities
    for (k=0; k&lt;itemSuffixes.length; k++){
       
         
     

     
        if(theTexts[3][itemSuffixes[k]][1][3] != &#39;&#39;){ 
         
            resultTxt = resultTxt + theTexts[3][itemSuffixes[k]][1][3] + &#39;.&lt;br&gt;&#39;;
         
        }

        addHp = addHp + theTexts[3][itemSuffixes[k]][1][4];
        addHg = addHg + theTexts[3][itemSuffixes[k]][1][5];
        addTh = addTh + theTexts[3][itemSuffixes[k]][1][6];
      
        specAlt =  theTexts[3][itemSuffixes[k]][1][7]; if (specAlt == 7){specAlt = Math.floor((Math.random() * 7) + 0);}
        if (specAlt == 8){ specPoints = specPoints + 1; } else {

            addSpec[specAlt] = addSpec[specAlt] + Math.floor( (Math.random() * (theTexts[3][itemSuffixes[k]][1][9] - theTexts[3][itemSuffixes[k]][1][8] + 1) ) + theTexts[3][itemSuffixes[k]][1][8] );
        }
    } //k  

 




       //item quality multiplier
       qualityModU =  theBuff * 4 / (2 + itemQuality);
       perModU= (specs[1] + 5) /10;       endModU=(specs[2] + 5) /10;
       qualityModD = theBuff * (2 + itemQuality) / 4;
       perModD= (15 - specs[1] ) /10;    endModD=  (15 - specs[2] ) /10;  

       if (addHp &lt; 0) { addHp = Math.round(addHp * qualityModD * perModD) } else  { addHp = Math.round(addHp * qualityModU * perModU)} 
       if (addHg &lt; 0) { addHg = Math.round(addHg * qualityModU * endModU) } else  { addHg = Math.round(addHg * qualityModD * endModD) } 
       if (addTh &lt; 0) { addTh = Math.round(addTh * qualityModU * endModU) } else  { addTh = Math.round(addTh * qualityModD * endModD) } 

    //describe results
    resultTxt = resultTxt + &#39;&lt;br&gt;&#39; + interfaceText[30] + &#39;&lt;br&gt;&lt;br&gt;&#39;;
    if (addHp&lt;0) {chgClr = &#39;#ff0000&gt; &#39;} else {chgClr = &#39;#006600&gt; +&#39;}
    if (addHp != 0 ) { 
        addHp = addHp * Math.round((100 + Math.floor((Math.random() * (randLims[pressedBtn][1]-randLims[pressedBtn][0])) + randLims[pressedBtn][0]))/100);
           stats[0] = stats[0] + addHp;
           if (addHp &lt; 0) { addHp = addHp - aSceptic * Math.round(Math.random()*1000 + 100) } else { addHp = addHp + anOptimist * Math.round(Math.random()*1000 + 100) }
           resultTxt = resultTxt + interfaceText[3] + &#39;&lt;font color=&#39; + chgClr  + addHp + &#39;&lt;/font&gt;&lt;br&gt;&#39;; 
     }
    if (addHg&lt;0) {chgClr = &#39;#006600&gt; &#39;} else {chgClr = &#39;#ff0000&gt; +&#39;}
    if (addHg != 0 ) {  
            stats[1] = stats[1] + addHg; 
            if (addHg &gt; 0) { addHg = addHg + aSceptic * Math.round(Math.random()*1000 + 100) } else { addHg = addHg - anOptimist * Math.round(Math.random()*1000 + 100) } 
            resultTxt = resultTxt + interfaceText[4] + &#39;&lt;font color=&#39; + chgClr + addHg + &#39;&lt;/font&gt;&lt;br&gt;&#39;; 
     }
    if (addTh&lt;0) {chgClr = &#39;#006600&gt; &#39;} else {chgClr = &#39;#ff0000&gt; +&#39;}
    if (addTh != 0 ) { 
            stats[2] = stats[2] + addTh;
            if (addTh &gt; 0) { addTh = addTh + aSceptic * Math.round(Math.random()*1000 + 100) } else { addTh = addTh - anOptimist * Math.round(Math.random()*1000 + 100) }
            resultTxt = resultTxt + interfaceText[5] + &#39;&lt;font color=&#39; + chgClr + addTh + &#39;&lt;/font&gt;&lt;br&gt;&#39;;
     }
  resultTxt = resultTxt + &#39;&lt;br&gt;&#39;;


    for (i=0; i&lt;7; i++){
      if (addSpec[i]&lt;0) {chgClr = &#39;#ff0000&gt; &#39;} else {chgClr = &#39;#006600&gt; +&#39;}
      if (addSpec[i] != 0 ) { 
              specs[i] = specs[i] + addSpec[i];
              resultTxt = resultTxt + interfaceText[7 + i] + &#39;&lt;font color=&#39; + chgClr + addSpec[i] + &#39;&lt;/font&gt;&lt;br&gt;&#39;;
       }    
    }






   //ability texts
   if (itemAbility&gt;0){
     isUsed = 0;
     for (i=0; i&lt; usedAbilities.length; i++){
       if (usedAbilities[i] == itemAbility) {isUsed = 1;}

     }
      if (isUsed == 0){
         resultTxt = resultTxt +  &#39;&lt;br&gt;&lt;i&gt;&#39; + theTexts[4][itemAbility][1] + &#39;.&lt;/i&gt;&lt;br&gt;&lt;br&gt;&#39;;

        //conditions are guaranted only for rare items
        if (itemQuality == 6 || (itemQuality ==5 &amp;&amp; Math.random() &gt; 0.5) || (itemQuality ==4 &amp;&amp; Math.random() &gt; 0.1) || (itemQuality ==3 &amp;&amp; Math.random() &gt; 0.01) ) {
            addCondition(theTexts[4][itemAbility][2]); 
        }


         usedAbilities.push(itemAbility);
         expAbilities.push(0);
      }
   }

  //replace words
   resultTxt = resultTxt.replace(new RegExp(&#39;:ip:&#39;,&#39;g&#39;),  theTexts[1][item][0][0]);
   resultTxt = resultTxt.replace(new RegExp(&#39;:rp:&#39;,&#39;g&#39;),  theTexts[1][item][0][1]);

  theBuff = 1;


  //trigger special events

    if (Math.random() &lt;= 0.5){
      resultTxt = resultTxt + &#39; &#39; + interfaceText[49] + &#39;&lt;br&gt;&#39;;
      checkSpecial();
    }

    
   //save eaten item
   chaMod = (50 + specs[3] * 10)/100;
    
   saveChance = Math.random();
   
        //check negative mod ability
        if ( !((itemQuality == 3 &amp;&amp; saveChance &lt; 0.2 * chaMod) ||
           (itemQuality == 4 &amp;&amp; saveChance &lt; 0.3 * chaMod) ||
           (itemQuality == 5 &amp;&amp; saveChance &lt; 0.5 * chaMod) ||
           (itemQuality == 6) )
            &amp;&amp; 
           ((itemQuality == 3 &amp;&amp; saveChance &lt; 0.2) ||
           (itemQuality == 4 &amp;&amp; saveChance &lt; 0.3) ||
           (itemQuality == 5 &amp;&amp; saveChance &lt; 0.5) ||
           (itemQuality == 6) )) {
    	        isUsed = 0;
                for (i=0; i&lt; originalDishes.length; i++){
                       if (originalDishes[i] == item){ isUsed = 1;}
                }
                if (isUsed ==0) { 
                       originalDishes.push(item) 
                
                       theTexts[1][item][2] = interfaceText[84];
                }
    	}	 
        
    	
   
   //save only 3,4,5,6
   if ( (itemQuality == 3 &amp;&amp; saveChance &lt; 0.2 * chaMod) ||
        (itemQuality == 4 &amp;&amp; saveChance &lt; 0.3 * chaMod) ||
        (itemQuality == 5 &amp;&amp; saveChance &lt; 0.5 * chaMod) ||
        (itemQuality == 6) ) {

     isUsed = 0;
     for (i=0; i&lt; originalDishes.length; i++){
       if (originalDishes[i] == item){ isUsed = 1;}
     }
     if (isUsed ==0) { 
         originalDishes.push(item) 
  
        //check mod ability
        if ( ((itemQuality == 3 &amp;&amp; saveChance &lt; 0.2 * chaMod) ||
           (itemQuality == 4 &amp;&amp; saveChance &lt; 0.3 * chaMod) ||
           (itemQuality == 5 &amp;&amp; saveChance &lt; 0.5 * chaMod) ||
           (itemQuality == 6)) 
            &amp;&amp; 
           !((itemQuality == 3 &amp;&amp; saveChance &lt; 0.2) ||
           (itemQuality == 4 &amp;&amp; saveChance &lt; 0.3) ||
           (itemQuality == 5 &amp;&amp; saveChance &lt; 0.5) ||
           (itemQuality == 6)) ) {

            theTexts[1][item][2] = interfaceText[48] +  theTexts[1][item][2];

        }


      }
   }	
    
    //trigger random encounter
    if(Math.random()&gt;0.1 &amp;&amp; isDead == 0 &amp;&amp; isRunAway == 0){
       getRandomCheck();
    }	
    

 }


  setStats();



  nextStep(0);


}

function checkSpecial(){
 
 var trigChance = 0;
 var trigTresh = 200;
 var specType = 0; 
 var gsum = 0;
 var gausPerc = [];
 var gaussMod = 0.7;     //inc this to inc chances
 var gausCorr = [0,0,0,0,0]
 var def_gausPerc = [0.05,4.15,9.3,16,20.5]
 var gausType = 0;
 setStats();

 for (i=0; i&lt;7; i++){

   trigChance = Math.floor((Math.random() * 100) + 1);

  
   switch ( specs[i] ) {
     case 0: trigTresh = 60; break; //30
     case 1: trigTresh = 70; break; //20
     case 2: trigTresh = 75; break; //15
     case 3: trigTresh = 80; break; //5
     case 4: trigTresh = 85; break; //1
     case 5: trigTresh = 100; break; //0
     case 6: trigTresh = 85; break; //1
     case 7: trigTresh = 80; break; //5
     case 8: trigTresh = 75; break; //15
     case 9: trigTresh = 70; break; //20
     case 10: trigTresh = 60; break; //30
   }


   //high agility increase treshhold, low decrease
   agiMod = (specs[5]-5) / 15;

   oldTT = trigTresh
   if (specs[i]&gt;5){
       trigTresh = trigTresh + (trigTresh - 100) * agiMod
   } else {
       trigTresh = trigTresh - (trigTresh - 100) * agiMod
   }

   if (trigChance &gt; trigTresh  &amp;&amp; isDead == 0 &amp;&amp; isRunAway == 0) {
     //trigger activates


     //correct pecentages
     for (k=0; k&lt;5; k++){
 
         gausCorr[k] = (Math.abs(specs[i] - 5) * gaussMod) * def_gausPerc[k] / 50; //the further from 5 the higher percent for rare cases
     }
     for (k=0;k&lt;5;k++){
         gausPerc[k] = def_gausPerc[k] - gausCorr[k] + gausCorr[4-k];
     }

      gausType = -1;

      //Gaussian distribution
      limGaus = Math.floor((Math.random() * 1000) + 0)/20;
   
      gsum = 0;
      for (k=0; k&lt;5; k++){
        gsum = gsum + gausPerc[k];
        if(limGaus &lt;= gsum &amp;&amp; gausType == -1){
         gausType = k;
        }
      }
 

      //low to low high to high
      if (specs[i]&gt;5) { specType = 9 - gausType } else { specType = gausType }

//specType = 4; //Investigate

      addMod = &#39;&#39;;
      if (trigChance &lt;= oldTT) {
            if( specs[5]&lt;5 ) { addMod = interfaceText[54] + &#39; &#39;} else{ addMod = interfaceText[55] + &#39; &#39;}
      }

          
       resultTxt = resultTxt + &#39;&lt;b&gt;&#39; + interfaceText[7 + i] + &#39;:&lt;/b&gt; &#39; +  addMod + eventTexts[i][1][specType] + &#39;. (&#39; + interfaceText[29] + Math.round( (100-trigTresh)* gausPerc[gausType]* 2)/100 +&#39; %).&lt;br&gt;&#39;;


      //section of spec-events occurences
      switch (i){

       case 0: switch(specType) {
                  case  0: addAchievement(5); isDead = 4; break;
                  case  1: addAchievement(6); 
                              addHp = -1 * Math.floor((Math.random() * 15 ) + 10);
                              resultTxt = resultTxt.replace(&#39;:hp:&#39;,&#39;&lt;font color=&#34;#ff0000&#34;&gt;&#39; + addHp + &#39;&lt;/font&gt;&#39;); stats[0] = stats[0]+addHp;  break;
                  case  2: addCondition( condTxt[4][1][ Math.floor((Math.random() * condTxt[4][1].length) + 0)]); break;
                  case  3: 
                              addHp = -1 * Math.floor((Math.random() * 10 ) + 3);
                              resultTxt = resultTxt.replace(&#39;:hp:&#39;,&#39;&lt;font color=&#34;#ff0000&#34;&gt;&#39; + addHp + &#39;&lt;/font&gt;&#39;); stats[0] = stats[0]+addHp;  break;
                  case  4: 
                              addHp = -1 * Math.floor((Math.random() * 5 ) + 1);
                              resultTxt = resultTxt.replace(&#39;:hp:&#39;,&#39;&lt;font color=&#34;#ff0000&#34;&gt;&#39; + addHp + &#39;&lt;/font&gt;&#39;); stats[0] = stats[0]+addHp;  break;
                  case  5: 
                              addHp = Math.floor((Math.random() * 5 ) + 1);
                              resultTxt = resultTxt.replace(&#39;:hp:&#39;,&#39;&lt;font color=&#34;#009900&#34;&gt;+&#39; + addHp + &#39;&lt;/font&gt;&#39;); stats[0] = stats[0]+addHp;   break;
                  case  6: 
                              addHp = Math.floor((Math.random() * 10 ) + 3);
                              resultTxt = resultTxt.replace(&#39;:hp:&#39;,&#39;&lt;font color=&#34;#009900&#34;&gt;+&#39; + addHp + &#39;&lt;/font&gt;&#39;); stats[0] = stats[0]+addHp;   break;
                  case  7: addCondition( condTxt[4][2][ Math.floor((Math.random() * condTxt[4][2].length) + 0)]); totalScore = totalScore + 1; break;
                  case  8: addAchievement(7);
                              addHp = Math.floor((Math.random() * 15 ) + 10);
                              resultTxt = resultTxt.replace(&#39;:hp:&#39;,&#39;&lt;font color=&#34;#009900&#34;&gt;+&#39; + addHp + &#39;&lt;/font&gt;&#39;); stats[0] = stats[0]+addHp;   break;
                  case  9: addAchievement(8); isRunAway = 1; break;
                  }
                  break;
       case 1: switch(specType) {
                  case  0: addAchievement(9); isDead = 4; break;
                  case  1: addAchievement(10);
                              addHg = Math.floor((Math.random() * 30 ) + 20);
                              resultTxt = resultTxt.replace(&#39;:hg:&#39;,&#39;&lt;font color=&#34;#ff0000&#34;&gt;+&#39; + addHg + &#39;&lt;/font&gt;&#39;); stats[1] = stats[1]+addHg;  break;
                  case  2: addCondition( condTxt[3][1][ Math.floor((Math.random() * condTxt[3][1].length) + 0)]); break;
                  case  3:
                              addHg = Math.floor((Math.random() * 30 ) + 10);
                              resultTxt = resultTxt.replace(&#39;:hg:&#39;,&#39;&lt;font color=&#34;#ff0000&#34;&gt;+&#39; + addHg + &#39;&lt;/font&gt;&#39;); stats[1] = stats[1]+addHg;  break;
                  case  4: 
                              addHg = Math.floor((Math.random() * 10 ) + 5);
                              resultTxt = resultTxt.replace(&#39;:hg:&#39;,&#39;&lt;font color=&#34;#ff0000&#34;&gt;+&#39; + addHg + &#39;&lt;/font&gt;&#39;); stats[1] = stats[1]+addHg;  break;
                  case  5: 
                              addHg = -1 * Math.floor((Math.random() * 10 ) + 5);
                              resultTxt = resultTxt.replace(&#39;:hg:&#39;,&#39;&lt;font color=&#34;#009900&#34;&gt;&#39; + addHg + &#39;&lt;/font&gt;&#39;); stats[1] = stats[1]+addHg;  break;
                  case  6: 
                              addHg = -1 * Math.floor((Math.random() * 30 ) + 10);
                              resultTxt = resultTxt.replace(&#39;:hg:&#39;,&#39;&lt;font color=&#34;#009900&#34;&gt;&#39; + addHg + &#39;&lt;/font&gt;&#39;); stats[1] = stats[1]+addHg;  break;
                  case  7: addCondition( condTxt[3][2][ Math.floor((Math.random() * condTxt[3][2].length) + 0)]); totalScore = totalScore + 1; break;
                  case  8: addAchievement(11); 
                              addHg = -1 * Math.floor((Math.random() * 30 ) + 20);
                              resultTxt = resultTxt.replace(&#39;:hg:&#39;,&#39;&lt;font color=&#34;#009900&#34;&gt;&#39; + addHg + &#39;&lt;/font&gt;&#39;); stats[1] = stats[1]+addHg;  break;
                  case  9:addAchievement(12); isRunAway = 1; break;
                  }
                  break;
       case 2: switch(specType) {
                  case  0: addAchievement(13); isDead = 4; break;
                  case  1: addAchievement(14); 
                              addTh = Math.floor((Math.random() * 30 ) + 20);
                              resultTxt = resultTxt.replace(&#39;:th:&#39;,&#39;&lt;font color=&#34;#ff0000&#34;&gt;+&#39; + addTh + &#39;&lt;/font&gt;&#39;); stats[2] = stats[2]+addTh; break;
                  case  2: addCondition(condTxt[5][1][ Math.floor((Math.random() * condTxt[5][1].length) + 0)]); break;
                  case  3:
                              addTh = Math.floor((Math.random() * 30 ) + 10);
                              resultTxt = resultTxt.replace(&#39;:th:&#39;,&#39;&lt;font color=&#34;#ff0000&#34;&gt;+&#39; + addTh + &#39;&lt;/font&gt;&#39;); stats[2] = stats[2]+addTh; break;
                  case  4: 
                              addTh = Math.floor((Math.random() * 10 ) + 5);
                              resultTxt = resultTxt.replace(&#39;:th:&#39;,&#39;&lt;font color=&#34;#ff0000&#34;&gt;+&#39; + addTh + &#39;&lt;/font&gt;&#39;); stats[2] = stats[2]+addTh; break;
                  case  5: 
                              addTh = -1 * Math.floor((Math.random() * 10 ) + 5);
                              resultTxt = resultTxt.replace(&#39;:th:&#39;,&#39;&lt;font color=&#34;#009900&#34;&gt;&#39; + addTh + &#39;&lt;/font&gt;&#39;); stats[2] = stats[2]+addTh; break;
                  case  6: 
                              addTh = -1 * Math.floor((Math.random() * 30 ) + 10);
                              resultTxt = resultTxt.replace(&#39;:th:&#39;,&#39;&lt;font color=&#34;#009900&#34;&gt;&#39; + addTh + &#39;&lt;/font&gt;&#39;); stats[2] = stats[2]+addTh; break;
                  case  7: addCondition(condTxt[5][2][ Math.floor((Math.random() * condTxt[5][2].length) + 0)]); totalScore = totalScore + 1; break;
                  case  8: addAchievement(15); 
                              addTh = -1 * Math.floor((Math.random() * 30 ) + 20);
                              resultTxt = resultTxt.replace(&#39;:th:&#39;,&#39;&lt;font color=&#34;#009900&#34;&gt;&#39; + addTh + &#39;&lt;/font&gt;&#39;); stats[2] = stats[2]+addTh; break;
                  case  9: addAchievement(16); isRunAway = 1; break;
                  }
                  break;
       case 3: switch(specType) {
                  case  0: addAchievement(17); isDead = 4; break;
                  case  1: addAchievement(18); money = money - 5000; break;
                  case  2: addCondition(condTxt[2][1][ Math.floor((Math.random() * condTxt[2][1].length) + 0)]); break;
                  case  3: money = money - 500; break;
                  case  4: money = money - 100; break;
                  case  5: money = money + 100; break;
                  case  6: money = money + 500; break;
                  case  7: addCondition(condTxt[2][2][ Math.floor((Math.random() * condTxt[2][2].length) + 0)]); totalScore = totalScore + 1; break;
                  case  8: addAchievement(19); money = money + 5000; break;
                  case  9: addAchievement(20); isRunAway = 1; break;
                  }
                  break;
       case 4: switch(specType) {
                  case  0: addAchievement(21); isDead = 4; break;
                  case  1: addAchievement(22); 
                              addSp = Math.floor((Math.random() * 7 ) + 0);
                              resultTxt = resultTxt.replace(&#39;:sp:&#39;, interfaceText[7 + addSp]); specs[addSp] = specs[addSp]-1; break;
                  case  2: addCondition(condTxt[1][1][ Math.floor((Math.random() * condTxt[1][1].length) + 0)]); break;
                  case  3: noDisplay = 1; break;
                  case  4: specType = 5;
                  case  5:                    
                            aff = Math.floor((Math.random() * 2) + 2); 
                            affInd = Math.floor((Math.random() * theTexts[aff].length) + 0);

                            maxStat = -9999;
                            statId = 0; specId = -1; theWay = interfaceText[62];
                            if (Math.abs( theTexts[aff][affInd][1][4] ) &gt; maxStat) {maxStat = theTexts[aff][affInd][1][4]; statId =0; if (theTexts[aff][affInd][1][4]&lt;0){theWay = interfaceText[63];} }
                            if (Math.abs( theTexts[aff][affInd][1][5] ) &gt; maxStat) {maxStat = theTexts[aff][affInd][1][5]; statId =1; if (theTexts[aff][affInd][1][5]&lt;0){theWay = interfaceText[63];}}
                            if (Math.abs( theTexts[aff][affInd][1][6] ) &gt; maxStat) {maxStat = theTexts[aff][affInd][1][6]; statId =2; if (theTexts[aff][affInd][1][6]&lt;0){theWay = interfaceText[63];}}
                            if (Math.abs( theTexts[aff][affInd][1][8] ) + Math.abs( theTexts[aff][affInd][1][9] ) &gt; Math.abs(maxStat)) {
                                    specId =theTexts[aff][affInd][1][7];
                                    if ( theTexts[aff][affInd][1][8]+theTexts[aff][affInd][1][9] &lt; 0){theWay = interfaceText[63];}
                            }
                            if (specId &gt; -1) { dpPar =  interfaceText[7 + specId]; if(specId ==7 || specId ==8){dpPar =  interfaceText[61]; } } else { dpPar =  interfaceText[3 + statId]}
  
                            resultTxt = resultTxt.replace(&#39;:pr:&#39;, theTexts[aff][affInd][0].trim());
                            resultTxt = resultTxt.replace(&#39;:st:&#39;, dpPar);
                            resultTxt = resultTxt.replace(&#39;:way:&#39;, theWay);
                            break;
    			  case  6: showChars = 3; break;		  
                  case  7: addCondition(condTxt[1][2][ Math.floor((Math.random() * condTxt[1][2].length) + 0)]); totalScore = totalScore + 1; break;
                  case  8: addAchievement(23); specPoints = specPoints +1; break;
                  case  9: addAchievement(24); isRunAway = 1; break;
                  }
                  break;
       case 5: switch(specType) {
                  case  0: addAchievement(25); isDead = 4; break;
                  case  1: addAchievement(26); 
                              addCondition(condTxt[4][0]); totalScore = totalScore + 4;
                              break;
                  case  2: addCondition(condTxt[6][1][ Math.floor((Math.random() * condTxt[6][1].length) + 0)]); break;
                  case  3: stId = Math.floor((Math.random() * 3) + 0); 
                              stAdd = Math.floor((Math.random() * 15) + 5); aSign =&#39;+&#39;; if(stId == 0){stAdd = stAdd * -1; aSign = &#39;&#39;}
                              stats[stId] = stats[stId] + stAdd; 
                              resultTxt = resultTxt.replace(&#39;:st:&#39;, interfaceText[3 + stId]);
                              resultTxt = resultTxt.replace(&#39;:ad:&#39;, &#39;&lt;font color=&#34;#ff0000&#34;&gt;&#39; + aSign + stAdd + &#39;&lt;/font&gt;&#39;); break;
                  case  4: stId = Math.floor((Math.random() * 3) + 0);  
                              stAdd = Math.floor((Math.random() * 12) + 1); aSign =&#39;+&#39;; if(stId == 0){stAdd = stAdd * -1; aSign = &#39;&#39;}
                              stats[stId] = stats[stId] + stAdd;
                              resultTxt = resultTxt.replace(&#39;:st:&#39;, interfaceText[3 + stId]);
                              resultTxt = resultTxt.replace(&#39;:ad:&#39;, &#39;&lt;font color=&#34;#ff0000&#34;&gt;&#39; + aSign + stAdd + &#39;&lt;/font&gt;&#39;); break;
                  case  5: stId = Math.floor((Math.random() * 3) + 0);  
                              stAdd = Math.floor((Math.random() * 12) + 1); aSign =&#39;+&#39;; if(stId &gt; 0){stAdd = stAdd * -1; aSign = &#39;&#39;}
                              stats[stId] = stats[stId] + stAdd;
                              resultTxt = resultTxt.replace(&#39;:st:&#39;, interfaceText[3 + stId]);
                              resultTxt = resultTxt.replace(&#39;:ad:&#39;, &#39;&lt;font color=&#34;#009900&#34;&gt;&#39; + aSign + stAdd + &#39;&lt;/font&gt;&#39;); break;
                  case  6: stId = Math.floor((Math.random() * 3) + 0); 
                              stAdd = Math.floor((Math.random() * 15) + 5); aSign =&#39;+&#39;; if(stId &gt; 0){stAdd = stAdd * -1; aSign = &#39;&#39;}
                              stats[stId] = stats[stId] + stAdd;
                              resultTxt = resultTxt.replace(&#39;:st:&#39;, interfaceText[3 + stId]);
                              resultTxt = resultTxt.replace(&#39;:ad:&#39;, &#39;&lt;font color=&#34;#009900&#34;&gt;&#39; + aSign + stAdd + &#39;&lt;/font&gt;&#39;); break;
                  case  7: addCondition(condTxt[6][2][ Math.floor((Math.random() * condTxt[6][2].length) + 0)]); totalScore = totalScore + 1; break;
                  case  8: addAchievement(27); 
                              addCondition(condTxt[5][0]); totalScore = totalScore + 5;
                              break;
                  case  9: addAchievement(28); isRunAway = 1; break;
                  }
                  break;
       case 6: switch(specType) {
                  case  0: addAchievement(29); isDead = 4; break;
                  case  1: addAchievement(30); totalScore = totalScore -7; break;
                  case  2: spc = Math.floor((Math.random() * condTxt.length - 1) + 1); addCondition(condTxt[spc][1][ Math.floor((Math.random() * condTxt[spc][1].length ) + 0)]); break;
                  case  3: totalScore = totalScore -4; break;
                  case  4: totalScore = totalScore -1; break;
                  case  5: totalScore = totalScore +1; break;
                  case  6: totalScore = totalScore +4; break;
                  case  7: spc = Math.floor((Math.random() * condTxt.length - 1) + 1); addCondition(condTxt[spc][2][ Math.floor((Math.random() * condTxt[spc][2].length ) + 0)]); totalScore = totalScore + 1; break;
                  case  8: addAchievement(31); totalScore = totalScore +7; break;
                  case  9: addAchievement(32); isRunAway = 1; break;
                  }
                  break;

      }



   } else {
      addMod = &#39;&#39;;
      if ( trigChance &gt; oldTT &amp;&amp; isDead == 0 &amp;&amp; isRunAway == 0) {

            if (specs[5]&gt;5) { addMod = interfaceText[57] + &#39;&lt;br&gt;&#39; } else { addMod = interfaceText[56] + &#39;&lt;br&gt;&#39;}
      
      }else{
           addMod = eventTexts[i][0]+ &#39;.&lt;br&gt;&#39;;
      }

      resultTxt = resultTxt + &#39;&lt;b&gt;&#39; + interfaceText[7 + i] + &#39;&lt;/b&gt; &#39; + addMod;
   }

 }

  resultTxt = resultTxt + &#39;&lt;br&gt;&#39;;

} 



function showBtn(ind) {
  switch (ind){
   case 0: lastMoney = 100; break;
   case 1: lastMoney = 300; break;
   case 2: lastMoney = 500; break;
   case 3: lastMoney = 700; break;
   case 4: lastMoney = 1000; oneKUsed = oneKUsed + 1; break;
  };

 money = money + lastMoney;

 pressedBtn = ind;
 pressedRecord[ind] = pressedRecord[ind] + 1;

 document.getElementById(&#34;trayBtn&#34;).style.display = &#39;block&#39;;
 document.getElementById(&#34;coinBtn&#34;).style.display = &#39;none&#39;;
 nextStep(1);
}

function redir_pg (){
top.location.href=&#34;http://scpfoundation.ru/scp-0004-ru-s&#34;;
}



&lt;/script&gt;
[[/html]]
[[/collapsible]]
[[/cell]]
[[/row]]

[[/table]]

[!-- 
--]</textarea></pre>
  </div>

</div>

<div id="footer">
  
    <em>Last updated 2024-02-07 18:30:35.528373.</em>
  
</div>
</body>